<!DOCTYPE html>
<html lang="es" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Creando roles con ansible - Linux Sysadmin</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://www.linuxsysadmin.ml/2016/08/creando-roles-con-ansible.html">

        <meta name="author" content="Gerard" />
        <meta name="keywords" content="ansible,playbook,rol" />
        <meta name="description" content="Ya vimos que es muy fácil crear varias máquinas iguales con ansible. A veces nos puede interesar disponer de recetas y decidir en un playbook general cuales de ellas ponemos en cada servidor. Una receta podría añadir un servidor de aplicaciones mientras que otra podría habilitarnos una bases de datos …" />

        <meta property="og:site_name" content="Linux Sysadmin" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Creando roles con ansible"/>
        <meta property="og:url" content="https://www.linuxsysadmin.ml/2016/08/creando-roles-con-ansible.html"/>
        <meta property="og:description" content="Ya vimos que es muy fácil crear varias máquinas iguales con ansible. A veces nos puede interesar disponer de recetas y decidir en un playbook general cuales de ellas ponemos en cada servidor. Una receta podría añadir un servidor de aplicaciones mientras que otra podría habilitarnos una bases de datos …"/>
        <meta property="article:published_time" content="2016-08-29" />
            <meta property="article:section" content="Operaciones" />
            <meta property="article:tag" content="ansible" />
            <meta property="article:tag" content="playbook" />
            <meta property="article:tag" content="rol" />
            <meta property="article:author" content="Gerard" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.linuxsysadmin.ml/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="https://www.linuxsysadmin.ml/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.linuxsysadmin.ml/theme/css/pygments/vim.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.linuxsysadmin.ml/theme/css/style.css" type="text/css"/>
        <link href="https://www.linuxsysadmin.ml/static/custom.css" rel="stylesheet">

        <link href="https://www.linuxsysadmin.ml/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin ATOM Feed"/>

        <link href="https://www.linuxsysadmin.ml/feeds/operaciones.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin Operaciones ATOM Feed"/>
    <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
    <script type="text/javascript">
        window.cookieconsent_options = {"message":"De acuerdo a la ley vigente, estoy obligado a informarte de la obviedad de que este sitio utiliza cookies.","dismiss":"Acepto","learnMore":"Mas información","link":null,"theme":"dark-bottom"};
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
    <!-- End Cookie Consent plugin -->

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.linuxsysadmin.ml/" class="navbar-brand">
Linux Sysadmin            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://www.linuxsysadmin.ml/about.html">
                             Sobre mí
                          </a></li>
                         <li><a href="https://www.linuxsysadmin.ml/curriculum.html">
                             Curriculum Vitae
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://www.linuxsysadmin.ml/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archivos</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="https://www.linuxsysadmin.ml" title="Linux Sysadmin"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="https://www.linuxsysadmin.ml/category/operaciones.html" title="Operaciones">Operaciones</a></li>
                <li class="active">Creando roles con ansible</li>
            </ol>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Banner linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="7977846974"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.linuxsysadmin.ml/2016/08/creando-roles-con-ansible.html"
                       rel="bookmark"
                       title="Permalink to Creando roles con ansible">
                        Creando roles con ansible
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Fecha</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-08-29T08:00:00+02:00"> 2016-08-29</time>
    </span>


            <span class="label label-default">Autor</span>
            <a href="https://www.linuxsysadmin.ml/author/gerard.html"><i class="fa fa-user"></i> Gerard</a>

        <span class="label label-default">Tiempo de lectura</span> 7 minutos
        <span class="label label-default">Categoría</span>
        <a href="https://www.linuxsysadmin.ml/category/operaciones.html">Operaciones</a>


<span class="label label-default">Tags</span>
	<a href="https://www.linuxsysadmin.ml/tag/ansible.html">ansible</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/playbook.html">playbook</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/rol.html">rol</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Ya vimos que es muy fácil crear varias máquinas iguales con <strong>ansible</strong>. A veces nos puede interesar disponer de recetas y decidir en un <em>playbook</em> general cuales de ellas ponemos en cada servidor. Una receta podría añadir un servidor de aplicaciones mientras que otra podría habilitarnos una bases de datos.</p>
<p>Esto nos permite combinar las recetas para desplegar toda la funcionalidad de nuestro servicio, distribuyéndolas entre nuestros servidores de acuerdo a las necesidades. Como ejemplo, podríamos poner el servidor de <em>PHP</em> y el de <em>MySQL</em> en recetas distintas; pondríamos las 2 en el mismo servidor para un entorno de test, y podríamos separar los servicios entre servidores (incluso replicando) en entornos mas profesionales.</p>
<p>Para esta demostración, vamos a crear <em>roles</em> para un entorno de un balanceador y dos servidores web normales. En ambos casos, el servicio estándar va a ser <strong>nginx</strong>, lo que nos abre a la posibilidad de reusar partes comunes, usando dependencias entre ellos.</p>
<p>También podemos encontrar roles prefabricados y listos para usarse en <a href="https://galaxy.ansible.com/">Ansible Galaxy</a>.</p>
<h2>El entorno</h2>
<p>Disponemos de 3 máquinas en el entorno, y de otra máquina desde la que lanzaremos los <em>playbooks</em>. Hemos utilizado los contenedores <strong>Docker</strong> de <a href="https://www.linuxsysadmin.ml/2016/06/controlando-contenedores-docker-con-ansible.html">otro artículo</a> por comodidad.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat inventory/hosts </span>
<span class="o">[</span>balancer<span class="o">]</span>
slave1

<span class="o">[</span>web<span class="o">]</span>
slave2
slave3
~ <span class="c1"># ansible -i inventory/ -m ping balancer</span>
slave1 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false, 
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
~ <span class="c1"># ansible -i inventory/ -m ping web</span>
slave2 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false, 
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
slave3 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false, 
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
~ <span class="c1"># </span>
</pre></div>


<h2>Como crear un rol</h2>
<p>Lo primero para entender que es un rol y como funcionan es mirar en <a href="http://docs.ansible.com/ansible/playbooks_roles.html#roles">la documentación</a>. Es especialmente interesante saber que tiene cada carpeta y para que sirve; solo voy a explicar las que usemos.</p>
<p>Lanzamos el comando <strong>ansible-galaxy</strong> para crear un rol vacío:</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># ansible-galaxy init --offline roles/test</span>
- roles/test was created successfully
~ <span class="c1"># tree roles/test/</span>
roles/test/
├── README.md
├── defaults
│   └── main.yml
├── files
├── handlers
│   └── main.yml
├── meta
│   └── main.yml
├── tasks
│   └── main.yml
├── templates
├── tests
│   ├── inventory
│   └── test.yml
└── vars
    └── main.yml

<span class="m">8</span> directories, <span class="m">8</span> files
~ <span class="c1"># </span>
</pre></div>


<p>Las carpetas mas interesantes son la de <em>tasks</em> la de <em>meta</em>, la de <em>files</em> y la de <em>templates</em>.</p>
<ul>
<li><strong>tasks</strong> &rarr; es donde se ponen los pasos a ejecutar en el <em>playbook</em>.</li>
<li><strong>meta</strong> &rarr; es donde se especifican las dependencias con otros roles.</li>
<li><strong>files</strong> y <strong>templates</strong> &rarr; aquí se ponen los ficheros que se utilizan en los módulos de ficheros y de plantillas, respectivamente.</li>
</ul>
<p>A partir de aquí se trata de eliminar las que no usemos y rellenar las que sí vayamos a usar.</p>
<h2>Diseño de roles</h2>
<p>Queremos preparar 2 tipos distintos de máquinas: el balanceador y los servidores web. En ambos casos se trata de instalar <strong>nginx</strong>, poner una configuración para la tarea que desempeñen, y en caso de los servidores web, poner el contenido estático.</p>
<p>Vamos a crear un <em>role</em> para el balanceador, y otro para los servidores web. Siguiendo la filosofía <a href="https://es.wikipedia.org/wiki/No_te_repitas">DRY (Don't repeat yourself)</a>, vamos a delegar la instalación de <strong>nginx</strong> a un tercer <em>role</em>, que a su vez será una dependencia para los otros dos.</p>
<p>Eso nos da 3 roles, con una estructura de ficheros simple; un rol para el <strong>nginx</strong> que solo ejecuta tareas, otro para el balanceador (con la dependencia y los ficheros auxiliares) y otro rol para el servidor web (con la dependencia y sus ficheros).</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># tree roles/</span>
roles/
├── balancer
│   ├── meta
│   │   └── main.yml
│   ├── tasks
│   │   └── main.yml
│   └── templates
│       └── balancer.j2
├── nginx
│   └── tasks
│       └── main.yml
└── web
    ├── meta
    │   └── main.yml
    ├── tasks
    │   └── main.yml
    └── templates
        ├── index.j2
        └── web.j2

<span class="m">10</span> directories, <span class="m">8</span> files
~ <span class="c1"># </span>
</pre></div>


<h3>El rol de nginx</h3>
<p>El único propósito de este rol es instalar <strong>nginx</strong>, retirar el <em>site</em> que viene por defecto, y asegurar que esté corriendo el servicio (en contenedores <strong>docker</strong> no se levantan tras instalarse). La idea es que el resto de roles van a poner una configuración y a recargar el <strong>nginx</strong> para aplicarla; así que de momento, nos vale.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat roles/nginx/tasks/main.yml </span>
---
- name: Install nginx
  apt: <span class="nv">name</span><span class="o">=</span>nginx-light <span class="nv">state</span><span class="o">=</span>installed
- name: Ensure example virtualhost is not there
  file: <span class="nv">path</span><span class="o">=</span>/etc/nginx/sites-enabled/default <span class="nv">state</span><span class="o">=</span>absent
- name: Ensure nginx is running
  service: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">state</span><span class="o">=</span>started
~ <span class="c1"># </span>
</pre></div>


<p>El resto de carpetas son innecesarias, así que las borramos.</p>
<h3>El rol web</h3>
<p>Este rol espera tener <strong>nginx</strong> instalado y se limita a poner la configuración del mismo, así como el contenido web.</p>
<p>El primer paso es declarar que tenemos una dependencia con el rol <em>nginx</em>. Esto se hace en la carpeta <em>meta</em>, y nos asegura que se habrá ejecutado antes el rol <em>nginx</em>.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat roles/web/meta/main.yml </span>
dependencies:
  - nginx
~ <span class="c1"># </span>
</pre></div>


<p>Ahora podemos especificar los pasos para tener nuestro rol completo, partiendo de un rol <em>nginx</em> aplicado. Básicamente se trata de poner la directiva <em>server</em> que nos interese, el contenido web en <em>/var/www/html</em> y hacer un <em>reload</em> del <strong>nginx</strong>.</p>
<p>Como punto interesante, se han usado plantillas para crear los ficheros destino. Esto nos permite crear las configuraciones basándonos en variables, que vendrán del <em>playbook</em> general. En el caso concreto de la configuración del <strong>nginx</strong> no era necesario usar plantillas porque no usa variables; se podría haber puesto el fichero en la carpeta <em>files</em> y usar el módulo <em>copy</em>.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat roles/web/tasks/main.yml </span>
---
- name: Put content virtualhost
  template: <span class="nv">src</span><span class="o">=</span>web.j2 <span class="nv">dest</span><span class="o">=</span>/etc/nginx/sites-enabled/web
- name: Put HTML files
  template: <span class="nv">src</span><span class="o">=</span>index.j2 <span class="nv">dest</span><span class="o">=</span>/var/www/html/index.html
- name: Reload nginx configuration
  service: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">state</span><span class="o">=</span>reloaded
~ <span class="c1"># </span>
</pre></div>


<p>Finalmente, necesitamos poner las plantillas en <em>templates</em>, siguiendo la sintaxis adecuada.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat roles/web/templates/web.j2 </span>
server <span class="o">{</span>
    root /var/www/html<span class="p">;</span>
    server_name _<span class="p">;</span>
<span class="o">}</span>
~ <span class="c1"># cat roles/web/templates/index.j2 </span>
Hello from <span class="o">{{</span> name <span class="o">}}</span>
~ <span class="c1"># </span>
</pre></div>


<p>Eliminamos todas las carpetas que no nos sirven, y hemos acabado.</p>
<h3>El rol balancer</h3>
<p>Partiendo de que tenemos <strong>nginx</strong> instalado, solo hay que poner una configuración concreta para que se haga balanceo, tras lo que haremos un <em>reload</em> del <strong>nginx</strong>.</p>
<p>Como en el caso anterior, tenemos que declarar la dependencia con el rol <em>nginx</em>.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat roles/balancer/meta/main.yml </span>
dependencies:
  - nginx
~ <span class="c1"># </span>
</pre></div>


<p>Los pasos, de forma análoga al caso anterior, se ponen en la carpeta <em>tasks</em>.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat roles/balancer/tasks/main.yml </span>
---
- name: Put balancer virtualhost
  template: <span class="nv">src</span><span class="o">=</span>balancer.j2 <span class="nv">dest</span><span class="o">=</span>/etc/nginx/sites-enabled/balancer
- name: Reload nginx configuration
  service: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">state</span><span class="o">=</span>reloaded
~ <span class="c1"># </span>
</pre></div>


<p>Y finalmente ponemos la plantilla para la configuración en <em>templates</em>. Nuevamente esperamos la variable <em>backends</em> desde el <em>playbook</em> principal, que es una lista de servidores de <em>backend</em>.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat roles/balancer/templates/balancer.j2 </span>
upstream backends <span class="o">{</span>
<span class="o">{</span>% <span class="k">for</span> backend in backends %<span class="o">}</span>
    server <span class="o">{{</span> backend <span class="o">}}</span><span class="p">;</span>
<span class="o">{</span>% endfor %<span class="o">}</span>
<span class="o">}</span>

server <span class="o">{</span>
    server_name _<span class="p">;</span>
    location / <span class="o">{</span>
        proxy_pass http://backends<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
~ <span class="c1"># </span>
</pre></div>


<p>Y limpiamos el resto de carpetas.</p>
<h2>Usando los roles</h2>
<p>Disponemos de tres máquinas, accesibles desde la red, con los nombres <em>slave1</em>, <em>slave2</em> y <em>slave3</em>. Como hemos visto en el fichero de inventario, el <em>slave1</em> va a ejercer de balanceador, mientras que los otros dos harán de servidores web.</p>
<p>Para ello solo hay que asignarles el rol que les toca, con las variables que estos roles necesitan. Teniendo los roles preparados, es tan fácil como indicar que servidor hace cada rol, indicando las variables que nos interesan en este entorno concreto.</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># cat myenv.yml </span>
- name: Install balancer
  hosts: balancer
  roles:
    - role: balancer
      backends:
        - slave2:80
        - slave3:80
- name: Install webservers
  hosts: web
  roles:
    - role: web
      name: <span class="s2">&quot;web_{{ ansible_hostname }}&quot;</span>
~ <span class="c1"># </span>
</pre></div>


<p>Lanzamos el <em>playbook</em>, para que nos monte nuestro entorno:</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># ansible-playbook -i inventory/ myenv.yml </span>

PLAY <span class="o">[</span>Install balancer<span class="o">]</span> ********************************************************

TASK <span class="o">[</span>setup<span class="o">]</span> *******************************************************************
ok: <span class="o">[</span>slave1<span class="o">]</span>

TASK <span class="o">[</span>nginx : Install nginx<span class="o">]</span> ***************************************************
changed: <span class="o">[</span>slave1<span class="o">]</span>

TASK <span class="o">[</span>nginx : Ensure example virtualhost is not there<span class="o">]</span> *************************
changed: <span class="o">[</span>slave1<span class="o">]</span>

TASK <span class="o">[</span>nginx : Ensure nginx is running<span class="o">]</span> *****************************************
changed: <span class="o">[</span>slave1<span class="o">]</span>

TASK <span class="o">[</span>balancer : Put balancer virtualhost<span class="o">]</span> *************************************
changed: <span class="o">[</span>slave1<span class="o">]</span>

TASK <span class="o">[</span>balancer : Reload nginx configuration<span class="o">]</span> ***********************************
changed: <span class="o">[</span>slave1<span class="o">]</span>

PLAY <span class="o">[</span>Install webservers<span class="o">]</span> ******************************************************

TASK <span class="o">[</span>setup<span class="o">]</span> *******************************************************************
ok: <span class="o">[</span>slave2<span class="o">]</span>
ok: <span class="o">[</span>slave3<span class="o">]</span>

TASK <span class="o">[</span>nginx : Install nginx<span class="o">]</span> ***************************************************
changed: <span class="o">[</span>slave2<span class="o">]</span>
changed: <span class="o">[</span>slave3<span class="o">]</span>

TASK <span class="o">[</span>nginx : Ensure example virtualhost is not there<span class="o">]</span> *************************
changed: <span class="o">[</span>slave3<span class="o">]</span>
changed: <span class="o">[</span>slave2<span class="o">]</span>

TASK <span class="o">[</span>nginx : Ensure nginx is running<span class="o">]</span> *****************************************
changed: <span class="o">[</span>slave3<span class="o">]</span>
changed: <span class="o">[</span>slave2<span class="o">]</span>

TASK <span class="o">[</span>web : Put content virtualhost<span class="o">]</span> *******************************************
changed: <span class="o">[</span>slave3<span class="o">]</span>
changed: <span class="o">[</span>slave2<span class="o">]</span>

TASK <span class="o">[</span>web : Put HTML files<span class="o">]</span> ****************************************************
changed: <span class="o">[</span>slave2<span class="o">]</span>
changed: <span class="o">[</span>slave3<span class="o">]</span>

TASK <span class="o">[</span>web : Reload nginx configuration<span class="o">]</span> ****************************************
changed: <span class="o">[</span>slave3<span class="o">]</span>
changed: <span class="o">[</span>slave2<span class="o">]</span>

PLAY RECAP *********************************************************************
slave1                     : <span class="nv">ok</span><span class="o">=</span><span class="m">6</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">5</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>   
slave2                     : <span class="nv">ok</span><span class="o">=</span><span class="m">7</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">6</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>   
slave3                     : <span class="nv">ok</span><span class="o">=</span><span class="m">7</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">6</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>   

~ <span class="c1"># </span>
</pre></div>


<p>Y verificamos que todo funciona como debe:</p>
<div class="highlight"><pre><span></span>~ <span class="c1"># for i in `seq 1 8`; do wget -qO- http://slave2:80/; done</span>
Hello from web_slave2
Hello from web_slave2
Hello from web_slave2
Hello from web_slave2
Hello from web_slave2
Hello from web_slave2
Hello from web_slave2
Hello from web_slave2
~ <span class="c1"># for i in `seq 1 8`; do wget -qO- http://slave3:80/; done</span>
Hello from web_slave3
Hello from web_slave3
Hello from web_slave3
Hello from web_slave3
Hello from web_slave3
Hello from web_slave3
Hello from web_slave3
Hello from web_slave3
~ <span class="c1"># for i in `seq 1 8`; do wget -qO- http://slave1:80/; done</span>
Hello from web_slave2
Hello from web_slave3
Hello from web_slave2
Hello from web_slave3
Hello from web_slave2
Hello from web_slave3
Hello from web_slave2
Hello from web_slave3
~ <span class="c1"># </span>
</pre></div>


<p>En caso de cambiar a un entorno con 8 servidores web, podemos usar los roles que tenemos y solamente cambiar <em>myenv.yml</em>.</p>
<p><strong><em>Fácil, ¿no?</em></strong></p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Posts relacionados:</h4>
    <ul>
        <li><a href="https://www.linuxsysadmin.ml/2016/09/lanzando-playbooks-de-ansible-desde-jenkins.html">Lanzando playbooks de Ansible desde Jenkins</a></li>
        <li><a href="https://www.linuxsysadmin.ml/2016/06/controlando-contenedores-docker-con-ansible.html">Controlando contenedores docker con ansible</a></li>
        <li><a href="https://www.linuxsysadmin.ml/2016/05/algunas-ideas-sueltas-sobre-ansible.html">Algunas ideas sueltas sobre Ansible</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

                    var disqus_identifier = 'creando-roles-con-ansible';
                var disqus_url = 'https://www.linuxsysadmin.ml/2016/08/creando-roles-con-ansible.html';

            var disqus_config = function () {
                this.language = "es";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sirtea"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
              </ul>
            </li>


            <li class="list-group-item"><a href="https://www.linuxsysadmin.ml/categories.html"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categorías</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/desarrollo.html">
                            <i class="fa fa-folder-open fa-lg"></i> Desarrollo
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/miscelanea.html">
                            <i class="fa fa-folder-open fa-lg"></i> Miscelánea
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/operaciones.html">
                            <i class="fa fa-folder-open fa-lg"></i> Operaciones
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/seguridad.html">
                            <i class="fa fa-folder-open fa-lg"></i> Seguridad
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/sistemas.html">
                            <i class="fa fa-folder-open fa-lg"></i> Sistemas
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/virtualizacion.html">
                            <i class="fa fa-folder-open fa-lg"></i> Virtualización
                        </a>
                    </li>
                </ul>
            </li>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="1931313371"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            <li class="list-group-item"><a href="https://www.linuxsysadmin.ml/tags.html"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/2-way-ssl.html">
                            2 way ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/ansible.html">
                            ansible
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/api.html">
                            api
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/apt.html">
                            apt
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/archlinux.html">
                            archlinux
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/autenticacion.html">
                            autenticación
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/autenticacion-basica.html">
                            autenticacion basica
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/backup.html">
                            backup
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/balanceador.html">
                            balanceador
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/bash.html">
                            bash
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/basico.html">
                            básico
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/blog.html">
                            blog
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/bridge.html">
                            bridge
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/build.html">
                            build
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/cache.html">
                            cache
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/centos.html">
                            centos
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/certificado.html">
                            certificado
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/cluster.html">
                            cluster
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/consul.html">
                            consul
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/contenedor.html">
                            contenedor
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/curl.html">
                            curl
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/debian.html">
                            debian
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/debootstrap.html">
                            debootstrap
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/dns.html">
                            dns
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/dnsmasq.html">
                            dnsmasq
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/docker.html">
                            docker
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/docker-compose.html">
                            docker-compose
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/dockerfile.html">
                            Dockerfile
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/escritorio.html">
                            escritorio
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/failover.html">
                            failover
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/firehol.html">
                            firehol
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/firewall.html">
                            firewall
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/flask.html">
                            flask
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/framework.html">
                            framework
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/gateway.html">
                            gateway
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/ghost.html">
                            ghost
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/git.html">
                            git
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/gpg.html">
                            gpg
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/haproxy.html">
                            haproxy
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/html.html">
                            html
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/https.html">
                            https
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/iptables.html">
                            iptables
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/iso.html">
                            iso
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/isolinux.html">
                            isolinux
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/jaula.html">
                            jaula
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/jenkins.html">
                            jenkins
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/jessie.html">
                            jessie
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/keepalived.html">
                            keepalived
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/linux.html">
                            linux
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/livecd.html">
                            livecd
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/logical-volume-manager.html">
                            logical volume manager
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/logs.html">
                            logs
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/logstash.html">
                            logstash
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/lvm.html">
                            lvm
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/lxc.html">
                            lxc
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/markdown.html">
                            markdown
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/microframework.html">
                            microframework
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/mongodb.html">
                            mongodb
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/mount.html">
                            mount
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/mysql.html">
                            mysql
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/nginx.html">
                            nginx
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/nmap.html">
                            nmap
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/passphrase.html">
                            passphrase
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/password.html">
                            password
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/perl.html">
                            perl
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/permisos.html">
                            permisos
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/php.html">
                            php
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/playbook.html">
                            playbook
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/proxy.html">
                            proxy
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/pypi.html">
                            PyPI
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/redhat.html">
                            redhat
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/registro.html">
                            registro
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/replica-set.html">
                            replica set
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/rest.html">
                            REST
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/rssh.html">
                            rssh
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/rsync.html">
                            rsync
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/script.html">
                            script
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/service-discovery.html">
                            service discovery
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/sftp.html">
                            sftp
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/sharding.html">
                            sharding
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/shorewall.html">
                            shorewall
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/squashfs.html">
                            squashfs
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/ssh.html">
                            ssh
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/ssl.html">
                            ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/stretch.html">
                            stretch
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/swarm.html">
                            swarm
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/systemd.html">
                            systemd
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/terminal.html">
                            terminal
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/traefik.html">
                            traefik
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/tunel.html">
                            túnel
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/ubuntu.html">
                            ubuntu
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/uwsgi.html">
                            uWSGI
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/variable.html">
                            variable
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/virtual-hosts.html">
                            virtual hosts
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/virtualenv.html">
                            virtualenv
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/volumenes.html">
                            volumenes
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/wheel.html">
                            wheel
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/xfce.html">
                            xfce
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/zerofree.html">
                            zerofree
                        </a>
                    </li>
                </ul>
            </li>


    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2019 Gerard
            &middot; Generado por <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Volver arriba</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.linuxsysadmin.ml/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.linuxsysadmin.ml/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.linuxsysadmin.ml/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-68486572-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>