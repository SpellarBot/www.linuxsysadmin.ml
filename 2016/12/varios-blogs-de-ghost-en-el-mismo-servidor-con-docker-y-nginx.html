<!DOCTYPE html>
<html lang="es" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Varios blogs de Ghost en el mismo servidor con Docker y Nginx - Linux Sysadmin</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://www.linuxsysadmin.ml/2016/12/varios-blogs-de-ghost-en-el-mismo-servidor-con-docker-y-nginx.html">

        <meta name="author" content="Gerard" />
        <meta name="keywords" content="ghost,blog,virtual hosts" />
        <meta name="description" content="Como ya vimos en un artículo anterior cada instancia de Ghost necesita una combinación de dirección y puerto distinta. Esto supone un problema porque la pesadez de indicar el puerto en el navegador. Podemos poner un único servidor Nginx que redirija las peticiones de forma transparente según el dominio pedido …" />

        <meta property="og:site_name" content="Linux Sysadmin" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Varios blogs de Ghost en el mismo servidor con Docker y Nginx"/>
        <meta property="og:url" content="http://www.linuxsysadmin.ml/2016/12/varios-blogs-de-ghost-en-el-mismo-servidor-con-docker-y-nginx.html"/>
        <meta property="og:description" content="Como ya vimos en un artículo anterior cada instancia de Ghost necesita una combinación de dirección y puerto distinta. Esto supone un problema porque la pesadez de indicar el puerto en el navegador. Podemos poner un único servidor Nginx que redirija las peticiones de forma transparente según el dominio pedido …"/>
        <meta property="article:published_time" content="2016-12-26" />
            <meta property="article:section" content="Miscelánea" />
            <meta property="article:tag" content="ghost" />
            <meta property="article:tag" content="blog" />
            <meta property="article:tag" content="virtual hosts" />
            <meta property="article:author" content="Gerard" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.linuxsysadmin.ml/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="http://www.linuxsysadmin.ml/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://www.linuxsysadmin.ml/theme/css/pygments/vim.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.linuxsysadmin.ml/theme/css/style.css" type="text/css"/>
        <link href="http://www.linuxsysadmin.ml/static/custom.css" rel="stylesheet">

        <link href="http://www.linuxsysadmin.ml/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin ATOM Feed"/>



        <link href="http://www.linuxsysadmin.ml/feeds/miscelanea.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin Miscelánea ATOM Feed"/>

    <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
    <script type="text/javascript">
        window.cookieconsent_options = {"message":"De acuerdo a la ley vigente, estoy obligado a informarte de la obviedad de que este sitio utiliza cookies.","dismiss":"Acepto","learnMore":"Mas información","link":null,"theme":"dark-bottom"};
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
    <!-- End Cookie Consent plugin -->

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.linuxsysadmin.ml/" class="navbar-brand">
Linux Sysadmin            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://www.linuxsysadmin.ml/about.html">
                             Sobre mí
                          </a></li>
                         <li><a href="http://www.linuxsysadmin.ml/curriculum.html">
                             Curriculum Vitae
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://www.linuxsysadmin.ml/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archivos</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="http://www.linuxsysadmin.ml" title="Linux Sysadmin"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="http://www.linuxsysadmin.ml/category/miscelanea.html" title="Miscelánea">Miscelánea</a></li>
                <li class="active">Varios blogs de Ghost en el mismo servidor con Docker y Nginx</li>
            </ol>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Banner linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="7977846974"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://www.linuxsysadmin.ml/2016/12/varios-blogs-de-ghost-en-el-mismo-servidor-con-docker-y-nginx.html"
                       rel="bookmark"
                       title="Permalink to Varios blogs de Ghost en el mismo servidor con Docker y Nginx">
                        Varios blogs de Ghost en el mismo servidor con Docker y Nginx
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Fecha</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-12-26T10:00:00+01:00"> 2016-12-26</time>
    </span>


            <span class="label label-default">Autor</span>
            <a href="http://www.linuxsysadmin.ml/author/gerard.html"><i class="fa fa-user"></i> Gerard</a>

        <span class="label label-default">Tiempo de lectura</span> 8 minutos
        <span class="label label-default">Categoría</span>
        <a href="http://www.linuxsysadmin.ml/category/miscelanea.html">Miscelánea</a>


<span class="label label-default">Tags</span>
	<a href="http://www.linuxsysadmin.ml/tag/ghost.html">ghost</a>
        /
	<a href="http://www.linuxsysadmin.ml/tag/blog.html">blog</a>
        /
	<a href="http://www.linuxsysadmin.ml/tag/virtual-hosts.html">virtual hosts</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Como ya vimos en <a href="http://www.linuxsysadmin.ml/2016/11/ghost-un-motor-para-hacer-blogs.html">un artículo anterior</a> cada instancia de <strong>Ghost</strong> necesita una combinación de dirección y puerto distinta. Esto supone un problema porque la pesadez de indicar el puerto en el navegador. Podemos poner un único servidor <strong>Nginx</strong> que redirija las peticiones de forma transparente según el dominio pedido.</p>
<p>Ya vimos la facilidad de levantar un contenedor con un <em>blog</em> de <strong>Ghost</strong>. De hecho, podemos levantar tantos como queramos, porque <strong>Docker</strong> provee a cada uno de su propia dirección IP. Sin embargo, la red de contenedores <strong>Docker</strong> es privada y no es visible para el resto del mundo.</p>
<p>Podemos solventar este problema exponiendo los puertos en la máquina huésped. Sin embargo, el hecho de que cada usuario tenga que indicar el puerto en la URL no es bonito. Así pues, vamos a esconder todos los contenedores sin exponer sus puertos. La única parte expuesta va a ser un contenedor <strong>Nginx</strong> representante de todo el sistema (esto es lo que se llama un <em>proxy</em> reverso), en el puerto 80. Este servicio va a recibir todas las peticiones a nuestro servidor, y las va a dirigir al contenedor que le corresponda de acuerdo con el dominio pedido.</p>
<p>Vamos a simplificarnos el proceso usando <strong>docker-compose</strong> para declarar el entorno y levantarlo de un solo comando. Es especialmente importante que las imágenes no se repitan, porque implicaría reconstruirlas cada vez. En vez de eso, vamos a abusar de las configuraciones vía variables de entorno.</p>
<p>Así nos quedaría la carpeta de proyecto:</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ tree
.
├── ghost_blog
│   ├── config.js
│   └── Dockerfile
├── proxy
│   ├── Dockerfile
│   ├── entrypoint.sh
│   ├── generate_configs.sh
│   └── nginx.conf
└── docker-compose.yml

<span class="m">2</span> directories, <span class="m">7</span> files
gerard@sirius:~/docker/multighost$ 
</pre></div>


<h2>La imagen de ghost</h2>
<p>Vamos a hacer una imagen para el entono de producción y vamos a dejar que use su propia base de datos <strong>sqlite</strong>. Como ya vimos, la configuración por defecto de la imagen para el entorno <em>production</em> está mal. Incluso aunque estuviera bien, hay parámetros que querremos cambiar, por ejemplo, la URL de nuestra web.</p>
<p>Por estos problemas, vamos a poner una nueva configuración. Como la imagen oficial no necesita mas cambios, el <em>Dockerfile</em> se limitará a poner la configuración en su sitio, partiendo de la imagen base.</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ cat ghost_blog/Dockerfile 
FROM ghost
COPY config.js /usr/src/ghost/config.example.js
gerard@sirius:~/docker/multighost$ 
</pre></div>


<p>Como no quiero crear una configuración e imagen para cada instancia de <strong>Ghost</strong>, voy a poner todas las partes diferentes en variables de entorno. El encargado de pasar estas variables de entorno va a ser el fichero <em>docker-compose.yml</em>, aunque se podría hacer a mano. El mismo intérprete de <strong>nodejs</strong> permite acceder a las mismas en el fichero <em>config.js</em>.</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ cat ghost_blog/config.js 
var <span class="nv">path</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;path&#39;</span><span class="o">)</span>,
    config<span class="p">;</span>

<span class="nv">config</span> <span class="o">=</span> <span class="o">{</span>
    production: <span class="o">{</span>
        url: process.env<span class="o">[</span><span class="s1">&#39;GHOST_URL&#39;</span><span class="o">]</span>,
        mail: <span class="o">{}</span>,
        database: <span class="o">{</span>
            client: <span class="s1">&#39;sqlite3&#39;</span>,
            connection: <span class="o">{</span>
                filename: path.join<span class="o">(</span>__dirname, <span class="s1">&#39;/content/data/ghost.db&#39;</span><span class="o">)</span>
            <span class="o">}</span>,
            debug: <span class="nb">false</span>
        <span class="o">}</span>,
        server: <span class="o">{</span>
            host: <span class="s1">&#39;127.0.0.1&#39;</span>,
            port: <span class="s1">&#39;2368&#39;</span>
        <span class="o">}</span>,
        paths: <span class="o">{</span>
            contentPath: path.join<span class="o">(</span>__dirname, <span class="s1">&#39;/content/&#39;</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span><span class="p">;</span>

module.exports <span class="o">=</span> config<span class="p">;</span>
gerard@sirius:~/docker/multighost$ 
</pre></div>


<p>La suerte en este caso es que solo hay una parte variable, que es la URL de nuestro sitio.</p>
<h2>La imagen del proxy HTTP</h2>
<p>Esta imagen es la de nuestro representante. Va a estar mapeada en el puerto 80 de nuestro servidor y va a recibir todas las peticiones que se nos hagan. Luego las enviará al contenedor responsable y devolverá la respuesta que este genera al usuario final. Podéis pensar en él como un policía de tráfico.</p>
<p>Nuevamente vamos a tirar de la reusabilidad, definiendo el comportamiento de este <em>proxy</em> mediante variables de entorno, que nos va a evitar reconstruirlo cada vez que añadamos mas <em>blogs</em>. La técnica de las plantillas para su configuración se vio en <a href="http://www.linuxsysadmin.ml/2016/09/imagenes-docker-reusables-mediante-configuraciones-dinamicas.html">otro artículo</a>.</p>
<p>Hacemos un <em>Dockerfile</em> propio, partiendo de una imagen mínima, a la que instalaremos <strong>nginx</strong> y sus configuraciones.</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ cat proxy/Dockerfile 
FROM alpine:3.4
RUN apk add --no-cache nginx <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ln -s /dev/stdout /var/log/nginx/access.log <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ln -s /dev/stderr /var/log/nginx/error.log <span class="o">&amp;&amp;</span> <span class="se">\</span>
    mkdir /run/nginx
COPY nginx.conf /etc/nginx/
COPY generate_configs.sh entrypoint.sh /
ENTRYPOINT <span class="o">[</span><span class="s2">&quot;/entrypoint.sh&quot;</span><span class="o">]</span>
gerard@sirius:~/docker/multighost$ 
</pre></div>


<p>Solo falta poner la configuración general, el punto de acceso al contenedor y el generador de configuraciones específicas según las variables de entorno.</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ cat proxy/nginx.conf 
worker_processes  <span class="m">1</span><span class="p">;</span>
events <span class="o">{</span>
    worker_connections  <span class="m">1024</span><span class="p">;</span>
<span class="o">}</span>
http <span class="o">{</span>
    include mime.types<span class="p">;</span>
    default_type application/octet-stream<span class="p">;</span>
    sendfile on<span class="p">;</span>
    keepalive_timeout <span class="m">65</span><span class="p">;</span>
    include conf.d/*<span class="p">;</span>
<span class="o">}</span>
gerard@sirius:~/docker/multighost$ cat proxy/generate_configs.sh 
<span class="c1">#!/bin/sh</span>

<span class="k">for</span> LINE in <span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">DOMAINS</span><span class="si">}</span> <span class="p">|</span> sed <span class="s1">&#39;s/;/ /g&#39;</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">DOMAIN</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$LINE</span> <span class="p">|</span> cut -d, -f1<span class="k">)</span>
    <span class="nv">BACKEND</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$LINE</span> <span class="p">|</span> cut -d, -f2<span class="k">)</span>
    <span class="nb">echo</span> -n <span class="s2">&quot;\</span>
<span class="s2">server {</span>
<span class="s2">    listen 80;</span>
<span class="s2">    server_name </span><span class="si">${</span><span class="nv">DOMAIN</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">    location / {</span>
<span class="s2">        proxy_pass http://</span><span class="si">${</span><span class="nv">BACKEND</span><span class="si">}</span><span class="s2">:2368;</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2">&quot;</span> &gt; /etc/nginx/conf.d/<span class="si">${</span><span class="nv">DOMAIN</span><span class="si">}</span>
<span class="k">done</span>
gerard@sirius:~/docker/multighost$ cat proxy/entrypoint.sh 
<span class="c1">#!/bin/sh</span>

/generate_configs.sh
<span class="nb">exec</span> /usr/sbin/nginx -g <span class="s2">&quot;daemon off;&quot;</span>
gerard@sirius:~/docker/multighost$ 
</pre></div>


<p>Como apunte, cabe decir que la configuración se genera a partir de la variable de entorno DOMAINS, que no es otra cosa que pares de dominio y <em>backend</em> (separados por una coma). Estos pares se separan de otros pares mediante el uso de un punto y coma.</p>
<h2>Declarando el entorno</h2>
<p>Vamos a suponer que tenemos dos dominios <em>ghost1.my</em> y <em>ghost2.my</em>. Como no los tengo de verdad, he usado el fichero <em>/etc/hosts</em> para que acaben en mi local, asignándoles la dirección IP 127.0.0.1.</p>
<p>Vamos a tener que declarar un servicio de <em>proxy</em> y dos de <strong>ghost</strong>. El motivo es porque todos los contenedores del mismo servicio heredan las mismas variables de entorno, con lo que eso de <em>escalar</em> no vale. Vamos a llamar a estos servicios <em>ghost1</em> y <em>ghost2</em>, aunque el nombre es arbitrario.</p>
<p>Otro tema puntiagudo son los nombres de los <em>backends</em>. De acuerdo con la convención usada por <strong>docker-compose</strong>, una instancia se llama {carpeta contenedora}_{nombre del servicio}_{numero de instancia}. Eso significa que los contenedores de los dos <em>blogs</em> van a llamarse <em>multighost_ghost1_1</em> y <em>multighost_ghost2_1</em> respectivamente.</p>
<p>El <em>docker-compose.yml</em> no tiene ningún misterio en sí mismo. Solo hay que tener en cuenta que necesitamos indicar las variables de entorno necesarias y que el <em>proxy</em> no se puede levantar antes que los <em>blogs</em>. Esto es porque <strong>nginx</strong> se cae si no puede resolver el nombre de las máquinas que forman parte de su configuración.</p>
<p>Así quedaría el <em>docker-compose.yml</em>:</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ cat docker-compose.yml 
version: <span class="s1">&#39;2&#39;</span>
services:
  proxy:
    build: proxy
    depends_on:
      - ghost1
      - ghost2
    links:
      - ghost1
      - ghost2
    ports:
      - <span class="s2">&quot;80:80&quot;</span>
    environment:
      - <span class="nv">DOMAINS</span><span class="o">=</span>ghost1.my,multighost_ghost1_1<span class="p">;</span>ghost2.my,multighost_ghost2_1
  ghost1:
    build: ghost_blog
    expose:
      - <span class="m">2368</span>
    environment:
      - <span class="nv">NODE_ENV</span><span class="o">=</span>production
      - <span class="nv">GHOST_URL</span><span class="o">=</span>http://ghost1.my
  ghost2:
    build: ghost_blog
    expose:
      - <span class="m">2368</span>
    environment:
      - <span class="nv">NODE_ENV</span><span class="o">=</span>production
      - <span class="nv">GHOST_URL</span><span class="o">=</span>http://ghost2.my
gerard@sirius:~/docker/multighost$ 
</pre></div>


<h2>Levantando el entorno</h2>
<p>Esto no supone ningún misterio; usaremos los mismo comandos de <strong>docker-compose</strong>.</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ docker-compose up -d
Creating network <span class="s2">&quot;multighost_default&quot;</span> with the default driver
Building ghost1
Step <span class="m">1</span> : FROM ghost
 ---&gt; c8799e5d02e1
Step <span class="m">2</span> : COPY config.js /usr/src/ghost/config.example.js
 ---&gt; a59babea33ac
Removing intermediate container 4afdb804e150
Successfully built a59babea33ac
Creating multighost_ghost1_1
Building ghost2
Step <span class="m">1</span> : FROM ghost
 ---&gt; c8799e5d02e1
Step <span class="m">2</span> : COPY config.js /usr/src/ghost/config.example.js
 ---&gt; Using cache
 ---&gt; a59babea33ac
Successfully built a59babea33ac
Creating multighost_ghost2_1
Building proxy
Step <span class="m">1</span> : FROM alpine:3.4
 ---&gt; 7d23b3ca3463
Step <span class="m">2</span> : RUN apk add --no-cache nginx <span class="o">&amp;&amp;</span>     ln -s /dev/stdout /var/log/nginx/access.log <span class="o">&amp;&amp;</span>     ln -s /dev/stderr /var/log/nginx/error.log <span class="o">&amp;&amp;</span>     mkdir /run/nginx
 ---&gt; Running in aa6bdbca5088
fetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.4/community/x86_64/APKINDEX.tar.gz
<span class="o">(</span><span class="m">1</span>/3<span class="o">)</span> Installing nginx-common <span class="o">(</span><span class="m">1</span>.10.1-r1<span class="o">)</span>
Executing nginx-common-1.10.1-r1.pre-install
<span class="o">(</span><span class="m">2</span>/3<span class="o">)</span> Installing pcre <span class="o">(</span><span class="m">8</span>.38-r1<span class="o">)</span>
<span class="o">(</span><span class="m">3</span>/3<span class="o">)</span> Installing nginx <span class="o">(</span><span class="m">1</span>.10.1-r1<span class="o">)</span>
Executing busybox-1.24.2-r11.trigger
OK: <span class="m">6</span> MiB in <span class="m">14</span> packages
 ---&gt; 6cb42f2e3eb3
Removing intermediate container aa6bdbca5088
Step <span class="m">3</span> : COPY nginx.conf /etc/nginx/
 ---&gt; f6f9c012d7e4
Removing intermediate container 881e06b92225
Step <span class="m">4</span> : COPY generate_configs.sh entrypoint.sh /
 ---&gt; aa0c311dec7d
Removing intermediate container f5351cfa8268
Step <span class="m">5</span> : ENTRYPOINT /entrypoint.sh
 ---&gt; Running in cf8151378f7e
 ---&gt; 7451c8ccbfe9
Removing intermediate container cf8151378f7e
Successfully built 7451c8ccbfe9
Creating multighost_proxy_1
gerard@sirius:~/docker/multighost$ 
</pre></div>


<p>Y ya tenemos nuestro entorno funcional.</p>
<div class="highlight"><pre><span></span>gerard@sirius:~/docker/multighost$ docker-compose ps
       Name                   Command            State         Ports        
---------------------------------------------------------------------------
multighost_ghost1_1   /entrypoint.sh npm start   Up      <span class="m">2368</span>/tcp           
multighost_ghost2_1   /entrypoint.sh npm start   Up      <span class="m">2368</span>/tcp           
multighost_proxy_1    /entrypoint.sh             Up      <span class="m">0</span>.0.0.0:80-&gt;80/tcp 
gerard@sirius:~/docker/multighost$ 
</pre></div>


<p>Solo faltaría abrir en un navegador y apuntar a <a href="http://ghost1.my/">http://ghost1.my/</a> y a <a href="http://ghost2.my/">http://ghost2.my/</a> para ver los resultados.</p>
<p>Es importante notar que la topología del entorno se declara solamente en el <em>docker-compose.yml</em>; en caso de poner mas <em>blogs</em>, no hay que tocar otros ficheros. Bastaría con declarar un <em>ghost3</em> y modificar las variables de entorno del <em>proxy</em>, para que genere su configuración.</p>
<h2>Esto no es el final</h2>
<p>A partir de aquí, se pueden aplicar muchas mejoras. Por ejemplo:</p>
<ul>
<li>Se podría levantar una base de datos <strong>mysql</strong> (u otra) en el fichero <em>docker-compose.yml</em>. El resto de instancias de <strong>Ghost</strong> podrían conectarse a esta base de datos, pasando los parámetros de conexión como variables de entorno, con lo que habría que modificar el <em>config.js</em>.</li>
<li>Otra posibilidad sería la de aprovecharnos de la capacidad de <em>escalar</em> el número de contenedores. Modificando la variable de entorno <em>DOMAINS</em> del <em>proxy</em> y el <em>script</em> generador de configuraciones <em>generate_configs.sh</em>, se podría balancear cada dominio entre varios contenedores. Esto tendría sentido siempre y cuando la base de datos no sea <strong>sqlite</strong>.</li>
</ul>
<p>La lista de mejoras podría crecer indefinidamente, pero por brevedad lo vamos a dejar como ejercicio para el lector.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Posts relacionados:</h4>
    <ul>
        <li><a href="http://www.linuxsysadmin.ml/2016/12/creando-un-tema-para-ghost.html">Creando un tema para Ghost</a></li>
        <li><a href="http://www.linuxsysadmin.ml/2016/11/ghost-un-motor-para-hacer-blogs.html">Ghost: Un motor para hacer blogs</a></li>
        <li><a href="http://www.linuxsysadmin.ml/2016/12/probando-virtualhosts-con-cabeceras-http.html">Probando virtualhosts con cabeceras HTTP</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

                    var disqus_identifier = 'varios-blogs-de-ghost-en-el-mismo-servidor-con-docker-y-nginx';
                var disqus_url = 'http://www.linuxsysadmin.ml/2016/12/varios-blogs-de-ghost-en-el-mismo-servidor-con-docker-y-nginx.html';

            var disqus_config = function () {
                this.language = "es";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sirtea"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
              </ul>
            </li>


            <li class="list-group-item"><a href="http://www.linuxsysadmin.ml/categories.html"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categorías</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="http://www.linuxsysadmin.ml/category/desarrollo.html">
                            <i class="fa fa-folder-open fa-lg"></i> Desarrollo
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://www.linuxsysadmin.ml/category/miscelanea.html">
                            <i class="fa fa-folder-open fa-lg"></i> Miscelánea
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://www.linuxsysadmin.ml/category/operaciones.html">
                            <i class="fa fa-folder-open fa-lg"></i> Operaciones
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://www.linuxsysadmin.ml/category/seguridad.html">
                            <i class="fa fa-folder-open fa-lg"></i> Seguridad
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://www.linuxsysadmin.ml/category/sistemas.html">
                            <i class="fa fa-folder-open fa-lg"></i> Sistemas
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://www.linuxsysadmin.ml/category/virtualizacion.html">
                            <i class="fa fa-folder-open fa-lg"></i> Virtualización
                        </a>
                    </li>
                </ul>
            </li>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="1931313371"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            <li class="list-group-item"><a href="http://www.linuxsysadmin.ml/tags.html"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/2-way-ssl.html">
                            2 way ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/alpine.html">
                            alpine
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/ansible.html">
                            ansible
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/api.html">
                            api
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/apt.html">
                            apt
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/archlinux.html">
                            archlinux
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/autenticacion.html">
                            autenticación
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/authorized_keys.html">
                            authorized_keys
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/balanceador.html">
                            balanceador
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/bash.html">
                            bash
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/basico.html">
                            básico
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/blog.html">
                            blog
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/bloques-reservados.html">
                            bloques reservados
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/bridge.html">
                            bridge
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/build.html">
                            build
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/cache.html">
                            cache
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/centos.html">
                            centos
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/certificado.html">
                            certificado
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/cluster.html">
                            cluster
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/consul.html">
                            consul
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/contenedor.html">
                            contenedor
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/css.html">
                            CSS
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/curl.html">
                            curl
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://www.linuxsysadmin.ml/tag/debian.html">
                            debian
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/debootstrap.html">
                            debootstrap
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/dns.html">
                            dns
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/dnsmasq.html">
                            dnsmasq
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://www.linuxsysadmin.ml/tag/docker.html">
                            docker
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/docker-compose.html">
                            docker-compose
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/dockerfile.html">
                            Dockerfile
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/escritorio.html">
                            escritorio
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/failover.html">
                            failover
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/firehol.html">
                            firehol
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/flask.html">
                            flask
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/framework.html">
                            framework
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/gateway.html">
                            gateway
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/ghost.html">
                            ghost
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/git.html">
                            git
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/haproxy.html">
                            haproxy
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/histfile.html">
                            histfile
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/html.html">
                            html
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/https.html">
                            https
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/jaula.html">
                            jaula
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://www.linuxsysadmin.ml/tag/jessie.html">
                            jessie
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/keepalived.html">
                            keepalived
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://www.linuxsysadmin.ml/tag/linux.html">
                            linux
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/logical-volume-manager.html">
                            logical volume manager
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/logs.html">
                            logs
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/logstash.html">
                            logstash
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/lvm.html">
                            lvm
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/lxc.html">
                            lxc
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/markdown.html">
                            markdown
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/memoria.html">
                            memoria
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/microframework.html">
                            microframework
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/migracion.html">
                            migración
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/mongodb.html">
                            mongodb
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/mount.html">
                            mount
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/nginx.html">
                            nginx
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/nmap.html">
                            nmap
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/passphrase.html">
                            passphrase
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/password.html">
                            password
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/pets-vs-cattle.html">
                            pets vs cattle
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/php.html">
                            php
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/playbook.html">
                            playbook
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/proxy.html">
                            proxy
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/pypi.html">
                            PyPI
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://www.linuxsysadmin.ml/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/redhat.html">
                            redhat
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/remota.html">
                            remota
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/replica-set.html">
                            replica set
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/rest.html">
                            REST
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/rssh.html">
                            rssh
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/rsync.html">
                            rsync
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/s6.html">
                            s6
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/script.html">
                            script
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/service-discovery.html">
                            service discovery
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/sftp.html">
                            sftp
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/shadow.html">
                            shadow
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/sharding.html">
                            sharding
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/squashfs.html">
                            squashfs
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://www.linuxsysadmin.ml/tag/ssh.html">
                            ssh
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/sshfs.html">
                            sshfs
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/ssl.html">
                            ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/stretch.html">
                            stretch
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/swap.html">
                            swap
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/swapfile.html">
                            swapfile
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/swarm.html">
                            swarm
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/systemd.html">
                            systemd
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/traefik.html">
                            traefik
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/tune2fs.html">
                            tune2fs
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/tunel.html">
                            túnel
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/ubuntu.html">
                            ubuntu
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://www.linuxsysadmin.ml/tag/unidad.html">
                            unidad
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/uwsgi.html">
                            uWSGI
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/variable.html">
                            variable
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/virtual-hosts.html">
                            virtual hosts
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://www.linuxsysadmin.ml/tag/virtualenv.html">
                            virtualenv
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/volumenes.html">
                            volumenes
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/wheel.html">
                            wheel
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://www.linuxsysadmin.ml/tag/xfce.html">
                            xfce
                        </a>
                    </li>
                </ul>
            </li>


    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Gerard
            &middot; Generado por <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Volver arriba</a></p></div>
      </div>
   </div>
</footer>
<script src="http://www.linuxsysadmin.ml/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.linuxsysadmin.ml/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.linuxsysadmin.ml/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-68486572-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>