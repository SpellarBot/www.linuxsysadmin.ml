<!DOCTYPE html>
<html lang="es" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Construyendo firewalls complejos de varias patas con shorewall - Linux Sysadmin</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://www.linuxsysadmin.ml/2019/04/construyendo-firewalls-complejos-de-varias-patas-con-shorewall.html">

        <meta name="author" content="Gerard" />
        <meta name="keywords" content="linux,firewall,iptables,shorewall,perl" />
        <meta name="description" content="Tras ver la facilidad con la que monté un firewall para un servidor solitario usando shorewall, he estado investigando sobre como hacer firewalls dedicados que enruten el tráfico en mis redes. En este artículo expongo lo que llegué a conseguir, esperando que le sirva a alguien en un futuro cercano …" />

        <meta property="og:site_name" content="Linux Sysadmin" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Construyendo firewalls complejos de varias patas con shorewall"/>
        <meta property="og:url" content="https://www.linuxsysadmin.ml/2019/04/construyendo-firewalls-complejos-de-varias-patas-con-shorewall.html"/>
        <meta property="og:description" content="Tras ver la facilidad con la que monté un firewall para un servidor solitario usando shorewall, he estado investigando sobre como hacer firewalls dedicados que enruten el tráfico en mis redes. En este artículo expongo lo que llegué a conseguir, esperando que le sirva a alguien en un futuro cercano …"/>
        <meta property="article:published_time" content="2019-04-24" />
            <meta property="article:section" content="Sistemas" />
            <meta property="article:tag" content="linux" />
            <meta property="article:tag" content="firewall" />
            <meta property="article:tag" content="iptables" />
            <meta property="article:tag" content="shorewall" />
            <meta property="article:tag" content="perl" />
            <meta property="article:author" content="Gerard" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.linuxsysadmin.ml/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="https://www.linuxsysadmin.ml/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.linuxsysadmin.ml/theme/css/pygments/vim.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.linuxsysadmin.ml/theme/css/style.css" type="text/css"/>
        <link href="https://www.linuxsysadmin.ml/static/custom.css" rel="stylesheet">

        <link href="https://www.linuxsysadmin.ml/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin ATOM Feed"/>

        <link href="https://www.linuxsysadmin.ml/feeds/sistemas.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin Sistemas ATOM Feed"/>
    <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
    <script type="text/javascript">
        window.cookieconsent_options = {"message":"De acuerdo a la ley vigente, estoy obligado a informarte de la obviedad de que este sitio utiliza cookies.","dismiss":"Acepto","learnMore":"Mas información","link":null,"theme":"dark-bottom"};
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
    <!-- End Cookie Consent plugin -->

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.linuxsysadmin.ml/" class="navbar-brand">
Linux Sysadmin            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://www.linuxsysadmin.ml/about.html">
                             Sobre mí
                          </a></li>
                         <li><a href="https://www.linuxsysadmin.ml/curriculum.html">
                             Curriculum Vitae
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://www.linuxsysadmin.ml/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archivos</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="https://www.linuxsysadmin.ml" title="Linux Sysadmin"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="https://www.linuxsysadmin.ml/category/sistemas.html" title="Sistemas">Sistemas</a></li>
                <li class="active">Construyendo firewalls complejos de varias patas con shorewall</li>
            </ol>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Banner linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="7977846974"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.linuxsysadmin.ml/2019/04/construyendo-firewalls-complejos-de-varias-patas-con-shorewall.html"
                       rel="bookmark"
                       title="Permalink to Construyendo firewalls complejos de varias patas con shorewall">
                        Construyendo firewalls complejos de varias patas con shorewall
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Fecha</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2019-04-24T14:00:00+02:00"> 2019-04-24</time>
    </span>


            <span class="label label-default">Autor</span>
            <a href="https://www.linuxsysadmin.ml/author/gerard.html"><i class="fa fa-user"></i> Gerard</a>

        <span class="label label-default">Tiempo de lectura</span> 9 minutos
        <span class="label label-default">Categoría</span>
        <a href="https://www.linuxsysadmin.ml/category/sistemas.html">Sistemas</a>


<span class="label label-default">Tags</span>
	<a href="https://www.linuxsysadmin.ml/tag/linux.html">linux</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/firewall.html">firewall</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/iptables.html">iptables</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/shorewall.html">shorewall</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/perl.html">perl</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Tras ver la facilidad con la que monté un <em>firewall</em> para un servidor solitario usando <strong>shorewall</strong>, he estado investigando sobre como hacer <em>firewalls</em> dedicados que enruten el tráfico en mis redes. En este artículo expongo lo que llegué a conseguir, esperando que le sirva a alguien en un futuro cercano.</p>
<p>Ya sabemos como instalar <strong>shorewall</strong> y cuales son los 4 ficheros básicos de su configuración, y de lo que hay que poner en ellos. En caso de no ser así, recomiendo empezar por el artículo anterior a este sobre <strong>shorewall</strong>, que es <a href="https://www.linuxsysadmin.ml/2019/04/protegiendo-servidores-con-iptables-usando-shorewall.html">este</a>.</p>
<p>Adicionalmente voy a especificar otros ficheros que se puedan necesitar, al tratarse de un <em>firewall</em> un poco más complejo.</p>
<h2>Un firewall de dos patas</h2>
<p>El primer caso a contemplar es el más simple: un <em>firewall</em> de dos patas, por el que circula en tráfico entre dos redes. Para ello vamos a poner una máquina con dos interfaces de red, una para esconder nuestra red local y otra para conectarse a una red de confiabilidad menor.</p>
<div class="highlight"><pre><span></span>gerard@firewall:/etc/shorewall$ ip a
<span class="m">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1</span>
    link/loopback <span class="m">00</span>:00:00:00:00:00 brd <span class="m">00</span>:00:00:00:00:00
    inet <span class="m">127</span>.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
<span class="m">2</span>: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP group default qlen <span class="m">1000</span>
    link/ether <span class="m">08</span>:00:27:a4:3a:22 brd ff:ff:ff:ff:ff:ff
    inet <span class="m">10</span>.0.2.15/24 brd <span class="m">10</span>.0.2.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fea4:3a22/64 scope link 
       valid_lft forever preferred_lft forever
<span class="m">3</span>: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP group default qlen <span class="m">1000</span>
    link/ether <span class="m">08</span>:00:27:e5:f9:ed brd ff:ff:ff:ff:ff:ff
    inet <span class="m">10</span>.0.0.1/24 brd <span class="m">10</span>.0.0.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fee5:f9ed/64 scope link 
       valid_lft forever preferred_lft forever
gerard@firewall:/etc/shorewall$ 
</pre></div>


<p>Vamos a definir los nombres con los que nos vamos a referir al <em>firewall</em> y a los dos segmentos de red. En este caso, <code>net</code> se refiere a la red menos confiable, <code>loc</code> a nuestra red local y <code>fw</code> al propio servidor <em>firewall</em>.</p>
<div class="highlight"><pre><span></span>gerard@firewall:/etc/shorewall$ cat zones 
fw firewall
net ipv4
loc ipv4
gerard@firewall:/etc/shorewall$ 
</pre></div>


<p>Asociamos los nombres de las zonas con las interfaces de red adecuadas. Esto requiere un poco de conocimiento del <em>hardware</em> y de como lo hemos enchufado. En mi caso, las suelo poner en orden de confiabilidad.</p>
<div class="highlight"><pre><span></span>gerard@firewall:/etc/shorewall$ cat interfaces 
net enp0s3 detect dhcp,tcpflags,nosmurfs,routefilter,logmartians
loc enp0s8 detect dhcp,tcpflags,nosmurfs,routefilter,logmartians
gerard@firewall:/etc/shorewall$ 
</pre></div>


<p>De forma similar, defino las políticas por defecto que se usan en todas las configuraciones. De forma casi mecánica le asigno capacidad para salir a internet a todo el mundo, descarto paquetes del exterior al <em>firewall</em> y a la red local, y rechazo todo el resto.</p>
<p>La política <code>REJECT</code> corta también la conectividad, pero a diferencia de <code>DROP</code>, lo hace de forma instantánea e informada, con lo que no hay <em>timeouts</em> dentro de nuestros segmentos de red. Esto también hace menos frustrante para nuestros compañeros si se equivocan de puerto o no se ha habilitado una regla adecuada todavía.</p>
<div class="highlight"><pre><span></span>gerard@firewall:/etc/shorewall$ cat policy 
net all DROP info
fw all ACCEPT
loc fw REJECT info
loc net ACCEPT
all all REJECT info
gerard@firewall:/etc/shorewall$ 
</pre></div>


<p>Vamos a asumir que nuestro <em>firewall</em> tiene instalado <strong>dnsmasq</strong>, como era el caso de <a href="https://www.linuxsysadmin.ml/2018/03/un-gateway-con-debian-iptables-y-dnsmasq.html">este otro artículo</a>. Adicionalmente, vamos a hacer <code>DNAT</code> para pasar las peticiones que hagan al <em>firewall</em> al puerto 80 a un servidor de la red local que sirva para ese fin (acordáos que es la IP pública de la red).</p>
<div class="highlight"><pre><span></span>gerard@firewall:/etc/shorewall$ cat rules 
ACCEPT net fw tcp <span class="m">22</span>
DNS<span class="o">(</span>ACCEPT<span class="o">)</span> loc fw
DNAT net loc:10.0.0.2:80 tcp <span class="m">80</span>
gerard@firewall:/etc/shorewall$ 
</pre></div>


<p><strong>AVISO</strong>: Los siguientes dos ficheros de configuración no eran necesarios en caso de un servidor solitario, y por lo tanto, son añadidos al artículo anterior.</p>
<p>Lo primero es hacer <code>MASQUERADE</code>, que es el proceso por el que los paquetes "adoptan" la dirección IP pública del <em>firewall</em> para salir a través de él. De esta forma, los paquetes sabrán volver, y el <em>firewall</em> los pasará al servidor original; sin esto, los paquetes no sabrían donde volver, ya que la red local queda oculta y normalmente tiene una dirección privada.</p>
<div class="highlight"><pre><span></span>gerard@firewall:/etc/shorewall$ cat snat 
MASQUERADE <span class="m">10</span>.0.0.0/24 enp0s3
gerard@firewall:/etc/shorewall$ 
</pre></div>


<p>Al haber varias interfaces de red implicadas, hay que activar el <code>IP_FORWARDING</code> para permitir pasar paquetes de interfaz en interfaz. Esto se puede hacer a nivel de sistema con el fichero <code>/etc/sysctl.conf</code>, o podemos delegarlo al servicio <strong>shorewall</strong>, para que se active y desactive con el servicio mismo.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ grep IP_FORWARD /etc/shorewall/shorewall.conf 
<span class="c1"># IP_FORWARDING=Keep</span>
<span class="nv">IP_FORWARDING</span><span class="o">=</span>Yes
gerard@firewall:~$ 
</pre></div>


<p><strong>AVISO</strong>: La directiva <code>IP_FORWARDING</code> solo puede aparecer una vez, y por ello hay que comentar la anterior. Si no se hace esto, el funcionamiento de la configuración es errático.</p>
<p>Finalmente activamos el servicio para que se levante tras cada reinicio.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ sudo systemctl <span class="nb">enable</span> shorewall
Synchronizing state of shorewall.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install <span class="nb">enable</span> shorewall
gerard@firewall:~$ 
</pre></div>


<p>Como hemos acabado, solo falta reiniciar el servidor; con reiniciar el servicio bastaría, pero me quiero asegurar de que levanta automáticamente.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ sudo reboot
...
</pre></div>


<h2>Un firewall de tres patas</h2>
<p>Este es otro caso de uso habitual, en instalaciones que tienen una red DMZ y una red local. En realidad no cambia gran cosa desde el caso de las dos patas, pero servirá de ejemplo de como ir añadiendo configuraciones.</p>
<p>Es servidor tiene tres interfaces de red, y siguiendo mi convención van a ir en orden de confiabilidad:</p>
<ul>
<li><code>enp0s3</code> &rarr; Red no confiable; vamos a llamar a su zona <code>net</code></li>
<li><code>enp0s8</code> &rarr; Red DMZ; vamos a llamar a su zona <code>dmz</code></li>
<li><code>enp0s9</code> &rarr; Red interna; vamos a llamar a su zona <code>loc</code></li>
</ul>
<p>Se pasa la configuración, para que se vean las direcciones del <em>firewall</em> en las 3 patas y los bloques de direcciones IP asignadas a cada segmento.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ ip a
<span class="m">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1</span>
    link/loopback <span class="m">00</span>:00:00:00:00:00 brd <span class="m">00</span>:00:00:00:00:00
    inet <span class="m">127</span>.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
<span class="m">2</span>: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP group default qlen <span class="m">1000</span>
    link/ether <span class="m">08</span>:00:27:a4:3a:22 brd ff:ff:ff:ff:ff:ff
    inet <span class="m">10</span>.0.2.15/24 brd <span class="m">10</span>.0.2.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fea4:3a22/64 scope link 
       valid_lft forever preferred_lft forever
<span class="m">3</span>: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP group default qlen <span class="m">1000</span>
    link/ether <span class="m">08</span>:00:27:e5:f9:ed brd ff:ff:ff:ff:ff:ff
    inet <span class="m">10</span>.0.0.1/24 brd <span class="m">10</span>.0.0.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fee5:f9ed/64 scope link 
       valid_lft forever preferred_lft forever
<span class="m">4</span>: enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP group default qlen <span class="m">1000</span>
    link/ether <span class="m">08</span>:00:27:ef:0a:20 brd ff:ff:ff:ff:ff:ff
    inet <span class="m">10</span>.0.1.1/24 brd <span class="m">10</span>.0.1.255 scope global enp0s9
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:feef:a20/64 scope link 
       valid_lft forever preferred_lft forever
gerard@firewall:~$ 
</pre></div>


<p>Lo primero es no olvidarnos el <code>IP_FORWARD</code>; lo ponemos ahora y listo. Es una configuraciñon que posiblemente no tocaremos nunca más...</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ grep IP_FORWARD /etc/shorewall/shorewall.conf 
<span class="c1"># IP_FORWARDING=Keep</span>
<span class="nv">IP_FORWARDING</span><span class="o">=</span>Yes
gerard@firewall:~$ 
</pre></div>


<p>Las zonas se declaran, una por línea; basta con añadir la zona correspondiente a la tercera interfaz de red.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ cat /etc/shorewall/zones 
fw firewall
net ipv4
loc ipv4
dmz ipv4
gerard@firewall:~$ 
</pre></div>


<p>Las interfaces también se declaran individualmente en cada línea; añadimos la nueva y listo. Hay que tener en cuenta la topología de la red; es crucial saber cuál esta enchufada en cada red.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ cat /etc/shorewall/interfaces 
net enp0s3 detect dhcp,tcpflags,nosmurfs,routefilter,logmartians
dmz enp0s8 detect dhcp,tcpflags,nosmurfs,routefilter,logmartians
loc enp0s9 detect dhcp,tcpflags,nosmurfs,routefilter,logmartians
gerard@firewall:~$ 
</pre></div>


<p>Las políticas se complican; cuantas más zonas tenemos, más combinaciones entre ellas salen. Por suerte disponemos del <em>keyword</em> <code>all</code> que nos simplifica mucho las políticas.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ cat /etc/shorewall/policy 
net all DROP info
fw all ACCEPT
all net ACCEPT
all all REJECT info
gerard@firewall:~$ 
</pre></div>


<p>Las reglas son similares al caso anterior, ya que solo hay que especificar lo que es estrictamente necesario. Es importante recalcar que se pueden indicar varias zonas, simplemente separándolas por comas.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ cat /etc/shorewall/rules 
ACCEPT net fw tcp <span class="m">22</span>
DNS<span class="o">(</span>ACCEPT<span class="o">)</span> dmz,loc fw
DNAT net dmz:10.0.0.2:80 tcp <span class="m">80</span>
gerard@firewall:~$ 
</pre></div>


<p>Como ahora hay dos redes detrás del <em>firewall</em>, tenemos que hacer el mecanismo de <code>MASQUERADE</code> para ambas, de forma que puedan salir a internet y recibir las respuestas de vuelta.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ cat /etc/shorewall/snat 
MASQUERADE <span class="m">10</span>.0.0.0/24 enp0s3
MASQUERADE <span class="m">10</span>.0.1.0/24 enp0s3
gerard@firewall:~$ 
</pre></div>


<h2>Uso de variables</h2>
<p>En un sistema de 3 o más patas se hace difícil de mantener las reglas que comunican todas las redes propias, especialmente porque las máquinas pueden cambiar sus direcciones, o pueden aparecer nuevos servidores de un tipo concreto. En este caso, es interesante saber que las reglas se pueden definir usando variables, que se declararían en el fichero <code>params</code>.</p>
<p>Esto se observa fácilmente con un ejemplo: nuestro servidor web es en realidad un balanceador, que reparte las peticiones entre un número indeterminado de <em>backends</em>. El balanceador está en la <em>dmz</em> y los <em>backends</em> en la red local, con lo que hay que habilitar una regla para evitar la política por defecto de <code>REJECT</code>.</p>
<p>Definimos las variables en el fichero <code>/etc/shorewall/params</code>, que pueden ser servidores solos o listas, separadas por comas. En realidad, durante la interpretación de reglas se hace una sustitución de dichas variables por sus cadenas, así que el formato importa poco, y depende del contexto en el que se inyecte.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ sudo cat /etc/shorewall/params 
<span class="nv">WEBSERVER</span><span class="o">=</span><span class="m">10</span>.0.0.2
<span class="nv">BACKENDS</span><span class="o">=</span><span class="m">10</span>.0.1.2,10.0.1.3
gerard@firewall:~$ 
</pre></div>


<p>Solo faltaría añadir o modificar la regla para usar variables; de esta forma, solo habría que ir actualizando las listas en el fichero <code>params</code>.</p>
<div class="highlight"><pre><span></span>gerard@firewall:~$ cat /etc/shorewall/rules 
ACCEPT net fw tcp <span class="m">22</span>
DNS<span class="o">(</span>ACCEPT<span class="o">)</span> dmz,loc fw
DNAT net dmz:<span class="nv">$WEBSERVER</span>:80 tcp <span class="m">80</span>
ACCEPT dmz:<span class="nv">$WEBSERVER</span> loc:<span class="nv">$BACKENDS</span> tcp <span class="m">8080</span>
gerard@firewall:~$ 
</pre></div>


<h2>Conclusión</h2>
<p>Con <strong>shorewall</strong> podemos hacer <em>firewalls</em> con tantas patas como queramos, de forma fácil y rápida. Definir <em>ip_forwarding</em>, <em>masquerade</em>, zonas, interfaces y políticas es realmente simple. Añadir reglas es fácil y más aún con el uso de variables.</p>
<p>A partir de aquí tenemos el conocimento y las herramientas para extender el patrón de <em>firewall</em> a tantas patas como queramos, aunque personalmente no usaría nunca más de tres, por la complejidad que suponen.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Posts relacionados:</h4>
    <ul>
        <li><a href="https://www.linuxsysadmin.ml/2019/04/protegiendo-servidores-con-iptables-usando-shorewall.html">Protegiendo servidores con iptables usando Shorewall</a></li>
        <li><a href="https://www.linuxsysadmin.ml/2018/03/un-gateway-con-debian-iptables-y-dnsmasq.html">Un gateway con Debian, iptables y dnsmasq</a></li>
        <li><a href="https://www.linuxsysadmin.ml/2019/04/ensamblando-un-livecd-con-debian-y-xorriso.html">Ensamblando un livecd con Debian y xorriso</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

                    var disqus_identifier = 'construyendo-firewalls-complejos-de-varias-patas-con-shorewall';
                var disqus_url = 'https://www.linuxsysadmin.ml/2019/04/construyendo-firewalls-complejos-de-varias-patas-con-shorewall.html';

            var disqus_config = function () {
                this.language = "es";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sirtea"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
              </ul>
            </li>


            <li class="list-group-item"><a href="https://www.linuxsysadmin.ml/categories.html"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categorías</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/desarrollo.html">
                            <i class="fa fa-folder-open fa-lg"></i> Desarrollo
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/miscelanea.html">
                            <i class="fa fa-folder-open fa-lg"></i> Miscelánea
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/operaciones.html">
                            <i class="fa fa-folder-open fa-lg"></i> Operaciones
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/seguridad.html">
                            <i class="fa fa-folder-open fa-lg"></i> Seguridad
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/sistemas.html">
                            <i class="fa fa-folder-open fa-lg"></i> Sistemas
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/virtualizacion.html">
                            <i class="fa fa-folder-open fa-lg"></i> Virtualización
                        </a>
                    </li>
                </ul>
            </li>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="1931313371"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            <li class="list-group-item"><a href="https://www.linuxsysadmin.ml/tags.html"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/2-way-ssl.html">
                            2 way ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/ansible.html">
                            ansible
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/api.html">
                            api
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/apt.html">
                            apt
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/archlinux.html">
                            archlinux
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/autenticacion.html">
                            autenticación
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/autenticacion-basica.html">
                            autenticacion basica
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/balanceador.html">
                            balanceador
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/bash.html">
                            bash
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/basico.html">
                            básico
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/blog.html">
                            blog
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/bridge.html">
                            bridge
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/build.html">
                            build
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/cache.html">
                            cache
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/centos.html">
                            centos
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/certificado.html">
                            certificado
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/cluster.html">
                            cluster
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/consul.html">
                            consul
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/contenedor.html">
                            contenedor
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/curl.html">
                            curl
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/debian.html">
                            debian
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/debootstrap.html">
                            debootstrap
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/dns.html">
                            dns
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/dnsmasq.html">
                            dnsmasq
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/docker.html">
                            docker
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/docker-compose.html">
                            docker-compose
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/dockerfile.html">
                            Dockerfile
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/escritorio.html">
                            escritorio
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/failover.html">
                            failover
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/firehol.html">
                            firehol
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/firewall.html">
                            firewall
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/flask.html">
                            flask
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/framework.html">
                            framework
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/gateway.html">
                            gateway
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/ghost.html">
                            ghost
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/git.html">
                            git
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/gpg.html">
                            gpg
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/grabacion.html">
                            grabación
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/haproxy.html">
                            haproxy
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/html.html">
                            html
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/https.html">
                            https
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/iptables.html">
                            iptables
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/iso.html">
                            iso
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/isolinux.html">
                            isolinux
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/jaula.html">
                            jaula
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/jenkins.html">
                            jenkins
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/jessie.html">
                            jessie
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/keepalived.html">
                            keepalived
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/linux.html">
                            linux
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/livecd.html">
                            livecd
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/logical-volume-manager.html">
                            logical volume manager
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/logs.html">
                            logs
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/logstash.html">
                            logstash
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/lvm.html">
                            lvm
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/lxc.html">
                            lxc
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/markdown.html">
                            markdown
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/microframework.html">
                            microframework
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/mongodb.html">
                            mongodb
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/mount.html">
                            mount
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/mysql.html">
                            mysql
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/nginx.html">
                            nginx
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/nmap.html">
                            nmap
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/passphrase.html">
                            passphrase
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/password.html">
                            password
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/perl.html">
                            perl
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/permisos.html">
                            permisos
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/php.html">
                            php
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/playbook.html">
                            playbook
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/proxy.html">
                            proxy
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/pypi.html">
                            PyPI
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/redhat.html">
                            redhat
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/registro.html">
                            registro
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/replica-set.html">
                            replica set
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/rest.html">
                            REST
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/rssh.html">
                            rssh
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/rsync.html">
                            rsync
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/script.html">
                            script
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/service-discovery.html">
                            service discovery
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/sftp.html">
                            sftp
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/sharding.html">
                            sharding
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/shorewall.html">
                            shorewall
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/squashfs.html">
                            squashfs
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/ssh.html">
                            ssh
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/ssl.html">
                            ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/stretch.html">
                            stretch
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/swarm.html">
                            swarm
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/systemd.html">
                            systemd
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/terminal.html">
                            terminal
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/traefik.html">
                            traefik
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/tunel.html">
                            túnel
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/ubuntu.html">
                            ubuntu
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/uwsgi.html">
                            uWSGI
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/variable.html">
                            variable
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/virtual-hosts.html">
                            virtual hosts
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/virtualenv.html">
                            virtualenv
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/volumenes.html">
                            volumenes
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/wheel.html">
                            wheel
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/xfce.html">
                            xfce
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/zerofree.html">
                            zerofree
                        </a>
                    </li>
                </ul>
            </li>


    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2019 Gerard
            &middot; Generado por <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Volver arriba</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.linuxsysadmin.ml/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.linuxsysadmin.ml/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.linuxsysadmin.ml/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-68486572-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>