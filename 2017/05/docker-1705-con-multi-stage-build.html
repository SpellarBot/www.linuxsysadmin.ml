<!DOCTYPE html>
<html lang="es" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Docker 17.05 con multi-stage build - Linux Sysadmin</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://www.linuxsysadmin.ml/2017/05/docker-1705-con-multi-stage-build.html">

        <meta name="author" content="Gerard" />
        <meta name="keywords" content="docker,dockerfile,multistage,build" />
        <meta name="description" content="Hacía tiempo que esperaba ansiosamente la nueva versión de docker. La raíz de tanta expectación son las mejoras que la versión candidata anunciaba, especialmente el nuevo modelo de build. Se ha modificado los Dockerfile para que puedan generar varias imágenes en un solo fichero, algunas de ellas partiendo de otras …" />

        <meta property="og:site_name" content="Linux Sysadmin" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Docker 17.05 con multi-stage build"/>
        <meta property="og:url" content="https://www.linuxsysadmin.ml/2017/05/docker-1705-con-multi-stage-build.html"/>
        <meta property="og:description" content="Hacía tiempo que esperaba ansiosamente la nueva versión de docker. La raíz de tanta expectación son las mejoras que la versión candidata anunciaba, especialmente el nuevo modelo de build. Se ha modificado los Dockerfile para que puedan generar varias imágenes en un solo fichero, algunas de ellas partiendo de otras …"/>
        <meta property="article:published_time" content="2017-05-22" />
            <meta property="article:section" content="Operaciones" />
            <meta property="article:tag" content="docker" />
            <meta property="article:tag" content="dockerfile" />
            <meta property="article:tag" content="multistage" />
            <meta property="article:tag" content="build" />
            <meta property="article:author" content="Gerard" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.linuxsysadmin.ml/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="https://www.linuxsysadmin.ml/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.linuxsysadmin.ml/theme/css/pygments/vim.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.linuxsysadmin.ml/theme/css/style.css" type="text/css"/>
        <link href="https://www.linuxsysadmin.ml/static/custom.css" rel="stylesheet">

        <link href="https://www.linuxsysadmin.ml/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin ATOM Feed"/>



        <link href="https://www.linuxsysadmin.ml/feeds/operaciones.atom.xml" type="application/atom+xml" rel="alternate"
              title="Linux Sysadmin Operaciones ATOM Feed"/>

    <!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
    <script type="text/javascript">
        window.cookieconsent_options = {"message":"De acuerdo a la ley vigente, estoy obligado a informarte de la obviedad de que este sitio utiliza cookies.","dismiss":"Acepto","learnMore":"Mas información","link":null,"theme":"dark-bottom"};
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
    <!-- End Cookie Consent plugin -->

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.linuxsysadmin.ml/" class="navbar-brand">
Linux Sysadmin            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://www.linuxsysadmin.ml/about.html">
                             Sobre mí
                          </a></li>
                         <li><a href="https://www.linuxsysadmin.ml/curriculum.html">
                             Curriculum Vitae
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://www.linuxsysadmin.ml/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archivos</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="https://www.linuxsysadmin.ml" title="Linux Sysadmin"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="https://www.linuxsysadmin.ml/category/operaciones.html" title="Operaciones">Operaciones</a></li>
                <li class="active">Docker 17.05 con multi-stage build</li>
            </ol>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Banner linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="7977846974"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.linuxsysadmin.ml/2017/05/docker-1705-con-multi-stage-build.html"
                       rel="bookmark"
                       title="Permalink to Docker 17.05 con multi-stage build">
                        Docker 17.05 con multi-stage build
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Fecha</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-05-22T10:00:00+02:00"> 2017-05-22</time>
    </span>


            <span class="label label-default">Autor</span>
            <a href="https://www.linuxsysadmin.ml/author/gerard.html"><i class="fa fa-user"></i> Gerard</a>

        <span class="label label-default">Tiempo de lectura</span> 7 minutos
        <span class="label label-default">Categoría</span>
        <a href="https://www.linuxsysadmin.ml/category/operaciones.html">Operaciones</a>


<span class="label label-default">Tags</span>
	<a href="https://www.linuxsysadmin.ml/tag/docker.html">docker</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/dockerfile.html">dockerfile</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/multistage.html">multistage</a>
        /
	<a href="https://www.linuxsysadmin.ml/tag/build.html">build</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Hacía tiempo que esperaba ansiosamente la nueva versión de <strong>docker</strong>. La raíz de tanta expectación son las mejoras que la versión candidata anunciaba, especialmente el nuevo modelo de <em>build</em>. Se ha modificado los <em>Dockerfile</em> para que puedan generar varias imágenes en un solo fichero, algunas de ellas partiendo de otras.</p>
<p>La gran mejora de la versión consiste en poder especificar varias veces el <em>keyword</em> <strong>FROM</strong>, para poder crear imágenes varias en el mismo fichero. Para ello, hay dos mejoras sustanciales en la sintaxis de los <em>keywords</em> <strong>FROM</strong> y <strong>COPY</strong>.</p>
<p>La idea es que puedes crear imágenes intermedias, para que luego algunas otras hereden de ella e incluso se puedan pasar ficheros entre sí. Eso se consigue con dos cambios nuevos:</p>
<ul>
<li>El <em>keyword</em> <strong>FROM</strong> puede incluir un <em>keywork</em> <strong>AS</strong>, que va a permitir heredar a las demás imágenes a partir de este <em>keyword</em>.</li>
<li>El <em>keyword</em> <strong>COPY</strong> puede llevar un <em>flag</em> <strong>--from</strong> que permite copiar ficheros entre las imágenes creadas por el mismo <em>Dockerfile</em>.</li>
</ul>
<p>Un ejemplo rápido:</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/ejemplo$ cat Dockerfile 
FROM alpine:3.5 AS base
CMD <span class="o">[</span><span class="s2">&quot;cat&quot;</span>, <span class="s2">&quot;/greeting&quot;</span><span class="o">]</span>

FROM base AS victim
RUN <span class="nb">echo</span> gold &gt; /stealme
RUN <span class="nb">echo</span> hello &gt; /greeting

FROM base
COPY --from<span class="o">=</span>victim /stealme /
RUN <span class="nb">echo</span> bye &gt; /greeting
gerard@aldebaran:~/docker/ejemplo$ 
</pre></div>


<p>Construimos la imagen como de costumbre:</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/ejemplo$ docker build -t ejemplo .
Sending build context to Docker daemon  <span class="m">2</span>.048kB
Step <span class="m">1</span>/8 : FROM alpine:3.5 AS base
 ---&gt; 4a415e366388
Step <span class="m">2</span>/8 : CMD cat /greeting
 ---&gt; Running in c27e95810829
 ---&gt; 36e7f6d769bd
Removing intermediate container c27e95810829
Step <span class="m">3</span>/8 : FROM base AS victim
 ---&gt; 36e7f6d769bd
Step <span class="m">4</span>/8 : RUN <span class="nb">echo</span> gold &gt; /stealme
 ---&gt; Running in 1ea9e0668bb7
 ---&gt; e0dc8c579221
Removing intermediate container 1ea9e0668bb7
Step <span class="m">5</span>/8 : RUN <span class="nb">echo</span> hello &gt; /greeting
 ---&gt; Running in e0da2940311e
 ---&gt; b2f3845ad8ff
Removing intermediate container e0da2940311e
Step <span class="m">6</span>/8 : FROM base
 ---&gt; 36e7f6d769bd
Step <span class="m">7</span>/8 : COPY --from<span class="o">=</span>victim /stealme /
 ---&gt; 918c21e97a6b
Removing intermediate container 4846e3cc50a7
Step <span class="m">8</span>/8 : RUN <span class="nb">echo</span> bye &gt; /greeting
 ---&gt; Running in e3ad8598d14d
 ---&gt; e451f40afe17
Removing intermediate container e3ad8598d14d
Successfully built e451f40afe17
Successfully tagged ejemplo:latest
gerard@aldebaran:~/docker/ejemplo$ 
</pre></div>


<p>Podemos ver que los pasos 3 y 6 parten ambos de la imagen <em>base</em>, mientras que la imagen final, copia un fichero de la imagen <em>victim</em>, de la que no hereda siquiera.</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/ejemplo$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE
ejemplo             latest              e451f40afe17        About a minute ago   <span class="m">3</span>.99MB
&lt;none&gt;              &lt;none&gt;              b2f3845ad8ff        About a minute ago   <span class="m">3</span>.99MB
alpine              <span class="m">3</span>.5                 4a415e366388        <span class="m">2</span> months ago         <span class="m">3</span>.99MB
gerard@aldebaran:~/docker/ejemplo$ docker run --rm b2f3845ad8ff
hello
gerard@aldebaran:~/docker/ejemplo$ docker run --rm ejemplo
bye
gerard@aldebaran:~/docker/ejemplo$ 
</pre></div>


<p>Otro detalle curioso es que el <em>tag</em> solo se puede dar a la imagen del último <strong>FROM</strong> del <em>Dockerfile</em>. Hay que tener en cuenta que si una imagen falla al construir, no se sigue con las demás.</p>
<h2>Posibles usos</h2>
<h3>Pipelines de test</h3>
<p>Cuando una imagen falla, el resto de imágenes no se construyen. Podemos aprovechar este punto para crear la imagen de test, ejecutando los tests necesarios. De esta forma, si los tests fallan, el <em>build</em> falla y no se genera la imagen posterior de <em>runtime</em>.</p>
<p>Supongamos este <em>Dockerfile</em>:</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/pipeline$ cat Dockerfile 
FROM alpine:3.5 AS base
RUN apk add --no-cache python2
COPY script.py /

FROM base
COPY tests.py /
RUN python tests.py

FROM base
CMD <span class="o">[</span><span class="s2">&quot;python&quot;</span>, <span class="s2">&quot;script.py&quot;</span><span class="o">]</span>
gerard@aldebaran:~/docker/pipeline$ 
</pre></div>


<p>Supongamos el el <em>script</em> de test falla; para ello he puesto un <em>script</em> que devuelve siempre un código de retorno "1".</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/pipeline$ docker build -t release .
Sending build context to Docker daemon  <span class="m">4</span>.096kB
...  
Step <span class="m">6</span>/8 : RUN python tests.py
 ---&gt; Running in 4572bed9ffb5
Tests FAILED
The <span class="nb">command</span> <span class="s1">&#39;/bin/sh -c python tests.py&#39;</span> returned a non-zero code: <span class="m">1</span>
gerard@aldebaran:~/docker/pipeline$ 
</pre></div>


<p>No se genera ningún <em>tag</em>, porque uno de los pasos ha fallado. De esta forma, no tenemos <em>release</em> porque tenerla no sirve de nada: está rota.</p>
<p>Veamos ahora lo que pasa si el test tiene éxito:</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/pipeline$ docker build -t release .
Sending build context to Docker daemon  <span class="m">4</span>.096kB
...  
Step <span class="m">6</span>/8 : RUN python tests.py
 ---&gt; Running in 5a8908410927
Tests OK
 ---&gt; 2cd640cc2122
Removing intermediate container 5a8908410927
Step <span class="m">7</span>/8 : FROM base
 ---&gt; 9a6cafb2fd49
Step <span class="m">8</span>/8 : CMD python script.py
 ---&gt; Running in bad18c8f4f27
 ---&gt; 6221630d5ac3
Removing intermediate container bad18c8f4f27
Successfully built 6221630d5ac3
Successfully tagged release:latest
gerard@aldebaran:~/docker/pipeline$ 
</pre></div>


<p>Y en este caso tenemos una release, con una imagen de <em>runtime</em>, sin los tests, y con la directiva <strong>CMD</strong> lista para ser usada.</p>
<h3>Reducción de capas</h3>
<p>A todos nos ha pasado que copiamos unos ficheros en nuestras imágenes, y tras aplicarles modificaciones de permisos y de usuarios, esos ficheros ocupan el doble o más. Es inevitable. La idea es poder utilizar una imagen grande para adecuar nuestros fichero y luego copiarlos a una imagen en su forma final.</p>
<p>Supongamos el siguiente ejemplo, donde <em>bigfile</em> es un fichero de 100mb con permisos 644 y que pertenece a mi usuario:</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/bigfiles$ cat Dockerfile 
FROM busybox AS builder
COPY bigfile /
RUN chmod <span class="m">777</span> /bigfile <span class="o">&amp;&amp;</span> <span class="se">\</span>
    chown nobody:nogroup /bigfile

FROM busybox
COPY --from<span class="o">=</span>builder /bigfile /
CMD <span class="o">[</span><span class="s2">&quot;ls&quot;</span>, <span class="s2">&quot;-lh&quot;</span>, <span class="s2">&quot;/&quot;</span><span class="o">]</span>
gerard@aldebaran:~/docker/bigfiles$ 
</pre></div>


<p>Construimos la imagen:</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/bigfiles$ docker build -t final .
Sending build context to Docker daemon  <span class="m">104</span>.9MB
Step <span class="m">1</span>/6 : FROM busybox AS builder
latest: Pulling from library/busybox
7520415ce762: Pull <span class="nb">complete</span> 
Digest: sha256:32f093055929dbc23dec4d03e09dfe971f5973a9ca5cf059cbfb644c206aa83f
Status: Downloaded newer image <span class="k">for</span> busybox:latest
 ---&gt; 00f017a8c2a6
Step <span class="m">2</span>/6 : COPY bigfile /
 ---&gt; 0a27ff02824b
Removing intermediate container 56007f1c8e9d
Step <span class="m">3</span>/6 : RUN chmod <span class="m">777</span> /bigfile <span class="o">&amp;&amp;</span>     chown nobody:nogroup /bigfile
 ---&gt; Running in b8ff92d84014
 ---&gt; bf3600cb8967
Removing intermediate container b8ff92d84014
Step <span class="m">4</span>/6 : FROM busybox
 ---&gt; 00f017a8c2a6
Step <span class="m">5</span>/6 : COPY --from<span class="o">=</span>builder /bigfile /
 ---&gt; 57b8aa7c2aeb
Removing intermediate container e2ec30bfd912
Step <span class="m">6</span>/6 : CMD ls -lh /
 ---&gt; Running in a212d95bb65f
 ---&gt; c672e1ad3fcb
Removing intermediate container a212d95bb65f
Successfully built c672e1ad3fcb
Successfully tagged final:latest
gerard@aldebaran:~/docker/bigfiles$ 
</pre></div>


<p>El resultado es sorprendente: Nos ahorramos el duplicado del fichero <em>bigfile</em>, y este conserva los permisos que le habíamos indicado, pero <strong>el usuario sigue siendo root</strong>.</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/bigfiles$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
final               latest              c672e1ad3fcb        <span class="m">2</span> minutes ago       106MB
&lt;none&gt;              &lt;none&gt;              bf3600cb8967        <span class="m">2</span> minutes ago       211MB
busybox             latest              00f017a8c2a6        <span class="m">2</span> months ago        <span class="m">1</span>.11MB
gerard@aldebaran:~/docker/bigfiles$ docker <span class="nb">history</span> bf3600cb8967
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
bf3600cb8967        <span class="m">4</span> minutes ago       <span class="p">|</span><span class="m">0</span> /bin/sh -c chmod <span class="m">777</span> /bigfile <span class="o">&amp;&amp;</span>     ch...   105MB               
0a27ff02824b        <span class="m">4</span> minutes ago       /bin/sh -c <span class="c1">#(nop) COPY file:777847f3f03c68...   105MB               </span>
00f017a8c2a6        <span class="m">2</span> months ago        /bin/sh -c <span class="c1">#(nop)  CMD [&quot;sh&quot;]                   0B                  </span>
&lt;missing&gt;           <span class="m">2</span> months ago        /bin/sh -c <span class="c1">#(nop) ADD file:c9ecd8ff00c653f...   1.11MB              </span>
gerard@aldebaran:~/docker/bigfiles$ docker <span class="nb">history</span> final
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
c672e1ad3fcb        <span class="m">4</span> minutes ago       /bin/sh -c <span class="c1">#(nop)  CMD [&quot;ls&quot; &quot;-lh&quot; &quot;/&quot;]         0B                  </span>
57b8aa7c2aeb        <span class="m">4</span> minutes ago       /bin/sh -c <span class="c1">#(nop) COPY file:5e392ba9fe1d0a...   105MB               </span>
00f017a8c2a6        <span class="m">2</span> months ago        /bin/sh -c <span class="c1">#(nop)  CMD [&quot;sh&quot;]                   0B                  </span>
&lt;missing&gt;           <span class="m">2</span> months ago        /bin/sh -c <span class="c1">#(nop) ADD file:c9ecd8ff00c653f...   1.11MB              </span>
gerard@aldebaran:~/docker/bigfiles$ docker run --rm final <span class="p">|</span> grep bigfile
-rwxrwxrwx    <span class="m">1</span> root     root      <span class="m">100</span>.0M May  <span class="m">9</span> <span class="m">13</span>:53 bigfile
gerard@aldebaran:~/docker/bigfiles$ 
</pre></div>


<p>Esto limita mucho el uso de esta solución.</p>
<h3>Build container pattern</h3>
<p>Construir nuestros artefactos en la misma imagen que los va a ejecutar es una guarrada. El truco era tener una imagen para construir el artefacto, y se pasaba a una imagen de <em>runtime</em> mediante un uso inteligente de volúmenes. Con el nuevo <strong>COPY --from</strong> no necesitamos el paso intermedio de volúmenes, y se puede hacer todo con un solo paso.</p>
<p>Supongamos que queremos crear un programa en C, compilarlo y tener una imagen que se limite a ejecutarlo:</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/test$ cat hello.c 
<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>

int main<span class="o">()</span> <span class="o">{</span>
    printf<span class="o">(</span><span class="s2">&quot;Hello world!\n&quot;</span><span class="o">)</span><span class="p">;</span>
    exit<span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
gerard@aldebaran:~/docker/test$ cat Dockerfile 
FROM alpine:3.5 AS builder
RUN apk add --no-cache gcc musl-dev
COPY hello.c /
RUN gcc -static -o /hello /hello.c <span class="o">&amp;&amp;</span> <span class="se">\</span>
    strip /hello

FROM scratch
COPY --from<span class="o">=</span>builder /hello /
CMD <span class="o">[</span><span class="s2">&quot;/hello&quot;</span><span class="o">]</span>
gerard@aldebaran:~/docker/test$ 
</pre></div>


<p>De esta forma, la primera imagen compila nuestro código fuente, y la segunda se limita a copiar el resultado, que al tratarse de un binario estático no necesita librerías adicionales, lo que nos permite partir de la imagen vacía <em>scratch</em>.</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/test$ docker build -t hello .
Sending build context to Docker daemon  <span class="m">3</span>.072kB
...  
Step <span class="m">5</span>/7 : FROM scratch
 ---&gt; 
Step <span class="m">6</span>/7 : COPY --from<span class="o">=</span>builder /hello /
 ---&gt; b01e9f03b69d
Removing intermediate container c177f03a3dab
Step <span class="m">7</span>/7 : CMD /hello
 ---&gt; Running in e19eb91bc975
 ---&gt; fb52f56a9c03
Removing intermediate container e19eb91bc975
Successfully built fb52f56a9c03
Successfully tagged hello:latest
gerard@aldebaran:~/docker/test$ 
</pre></div>


<p>Y con esto podemos desechar la imagen de compilación que es muy grande, en favor a una imagen de <em>runtime</em> sin compiladores ni librerías, sin necesidad de preocuparnos de limpiar aquello que se haya instalado para compilar nuestro binario.</p>
<div class="highlight"><pre><span></span>gerard@aldebaran:~/docker/test$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello               latest              fb52f56a9c03        <span class="m">2</span> minutes ago       <span class="m">10</span>.1kB
&lt;none&gt;              &lt;none&gt;              fe6a6edae999        <span class="m">2</span> minutes ago       101MB
alpine              <span class="m">3</span>.5                 4a415e366388        <span class="m">2</span> months ago        <span class="m">3</span>.99MB
gerard@aldebaran:~/docker/test$ docker run -ti --rm hello
Hello world!
gerard@aldebaran:~/docker/test$ 
</pre></div>


<p>Es especialmente interesante ver que hacen falta 101mb para construir un binario que solo necesita 10kb para ejecutarse...</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Posts relacionados:</h4>
    <ul>
        <li><a href="https://www.linuxsysadmin.ml/2017/09/un-proceso-inicial-para-docker-tini-y-dumb-init.html">Un proceso inicial para docker: tini y dumb-init</a></li>
        <li><a href="https://www.linuxsysadmin.ml/2017/08/creando-imagenes-con-estilo-la-instruccion-onbuild.html">Creando imágenes con estilo: la instrucción ONBUILD</a></li>
        <li><a href="https://www.linuxsysadmin.ml/2017/05/reduciendo-el-tiempo-de-build-con-docker-y-su-cache.html">Reduciendo el tiempo de build con Docker y su caché</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

                    var disqus_identifier = 'docker-1705-con-multi-stage-build';
                var disqus_url = 'https://www.linuxsysadmin.ml/2017/05/docker-1705-con-multi-stage-build.html';

            var disqus_config = function () {
                this.language = "es";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sirtea"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
              </ul>
            </li>


            <li class="list-group-item"><a href="https://www.linuxsysadmin.ml/categories.html"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categorías</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/desarrollo.html">
                            <i class="fa fa-folder-open fa-lg"></i> Desarrollo
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/miscelanea.html">
                            <i class="fa fa-folder-open fa-lg"></i> Miscelánea
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/operaciones.html">
                            <i class="fa fa-folder-open fa-lg"></i> Operaciones
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/seguridad.html">
                            <i class="fa fa-folder-open fa-lg"></i> Seguridad
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/sistemas.html">
                            <i class="fa fa-folder-open fa-lg"></i> Sistemas
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://www.linuxsysadmin.ml/category/virtualizacion.html">
                            <i class="fa fa-folder-open fa-lg"></i> Virtualización
                        </a>
                    </li>
                </ul>
            </li>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar linuxsysadmin -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6984858420847602"
     data-ad-slot="1931313371"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            <li class="list-group-item"><a href="https://www.linuxsysadmin.ml/tags.html"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/2-way-ssl.html">
                            2 way ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/ansible.html">
                            ansible
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/api.html">
                            api
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/apt.html">
                            apt
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/archlinux.html">
                            archlinux
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/autenticacion.html">
                            autenticación
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/autenticacion-basica.html">
                            autenticacion basica
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/balanceador.html">
                            balanceador
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/bash.html">
                            bash
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/basico.html">
                            básico
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/blog.html">
                            blog
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/bridge.html">
                            bridge
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/build.html">
                            build
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/cache.html">
                            cache
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/centos.html">
                            centos
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/certificado.html">
                            certificado
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/cluster.html">
                            cluster
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/consul.html">
                            consul
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/contenedor.html">
                            contenedor
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/curl.html">
                            curl
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/debian.html">
                            debian
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/debootstrap.html">
                            debootstrap
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/dns.html">
                            dns
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/dnsmasq.html">
                            dnsmasq
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/docker.html">
                            docker
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/docker-compose.html">
                            docker-compose
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/dockerfile.html">
                            Dockerfile
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/drill.html">
                            drill
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/escritorio.html">
                            escritorio
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/failover.html">
                            failover
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/firehol.html">
                            firehol
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/flask.html">
                            flask
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/framework.html">
                            framework
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/gateway.html">
                            gateway
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/geolocalizacion.html">
                            geolocalización
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/ghost.html">
                            ghost
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/git.html">
                            git
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/haproxy.html">
                            haproxy
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/html.html">
                            html
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/https.html">
                            https
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/jaula.html">
                            jaula
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/jenkins.html">
                            jenkins
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/jessie.html">
                            jessie
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/json.html">
                            JSON
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/jsonschema.html">
                            jsonschema
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/keepalived.html">
                            keepalived
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/linux.html">
                            linux
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/logical-volume-manager.html">
                            logical volume manager
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/logs.html">
                            logs
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/logstash.html">
                            logstash
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/lvm.html">
                            lvm
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/lxc.html">
                            lxc
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/mariadb.html">
                            mariadb
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/markdown.html">
                            markdown
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/master.html">
                            master
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/mediawiki.html">
                            mediawiki
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/microframework.html">
                            microframework
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/mongodb.html">
                            mongodb
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/mount.html">
                            mount
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/mysql.html">
                            mysql
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/nginx.html">
                            nginx
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/nmap.html">
                            nmap
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/passphrase.html">
                            passphrase
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/password.html">
                            password
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/php.html">
                            php
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/playbook.html">
                            playbook
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/proxy.html">
                            proxy
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/pypi.html">
                            PyPI
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/redhat.html">
                            redhat
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/registro.html">
                            registro
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/replica-set.html">
                            replica set
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/rest.html">
                            REST
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/rssh.html">
                            rssh
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/rsync.html">
                            rsync
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/script.html">
                            script
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/service-discovery.html">
                            service discovery
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/sftp.html">
                            sftp
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/sharding.html">
                            sharding
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/slack.html">
                            slack
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/slave.html">
                            slave
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/squashfs.html">
                            squashfs
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://www.linuxsysadmin.ml/tag/ssh.html">
                            ssh
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/ssl.html">
                            ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/stretch.html">
                            stretch
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/swarm.html">
                            swarm
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/systemd.html">
                            systemd
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/tls.html">
                            tls
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/traefik.html">
                            traefik
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/tunel.html">
                            túnel
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/ubuntu.html">
                            ubuntu
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/uwsgi.html">
                            uWSGI
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/variable.html">
                            variable
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/virtual-hosts.html">
                            virtual hosts
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://www.linuxsysadmin.ml/tag/virtualenv.html">
                            virtualenv
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/volumenes.html">
                            volumenes
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/webhooks.html">
                            webhooks
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/wheel.html">
                            wheel
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://www.linuxsysadmin.ml/tag/wiki.html">
                            wiki
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://www.linuxsysadmin.ml/tag/xfce.html">
                            xfce
                        </a>
                    </li>
                </ul>
            </li>


    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Gerard
            &middot; Generado por <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Volver arriba</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.linuxsysadmin.ml/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.linuxsysadmin.ml/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.linuxsysadmin.ml/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'linuxsysadmin-gmb'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-68486572-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>